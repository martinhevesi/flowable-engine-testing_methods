<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>HistoricVariableInstanceEntityManagerImpl.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jacoco.exec</a> &gt; <a href="index.source.html" class="el_package">org.flowable.variable.service.impl.persistence.entity</a> &gt; <span class="el_source">HistoricVariableInstanceEntityManagerImpl.java</span></div><h1>HistoricVariableInstanceEntityManagerImpl.java</h1><pre class="source lang-java linenums">/* Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *      http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.flowable.variable.service.impl.persistence.entity;

import java.util.Collection;
import java.util.Date;
import java.util.List;
import java.util.Map;

import org.flowable.common.engine.impl.persistence.entity.AbstractServiceEngineEntityManager;
import org.flowable.variable.api.history.HistoricVariableInstance;
import org.flowable.variable.service.VariableServiceConfiguration;
import org.flowable.variable.service.impl.HistoricVariableInstanceQueryImpl;
import org.flowable.variable.service.impl.persistence.entity.data.HistoricVariableInstanceDataManager;

/**
 * @author Christian Lipphardt (camunda)
 * @author Joram Barrez
 */
public class HistoricVariableInstanceEntityManagerImpl
    extends AbstractServiceEngineEntityManager&lt;VariableServiceConfiguration, HistoricVariableInstanceEntity, HistoricVariableInstanceDataManager&gt;
    implements HistoricVariableInstanceEntityManager {

    public HistoricVariableInstanceEntityManagerImpl(VariableServiceConfiguration variableServiceConfiguration, HistoricVariableInstanceDataManager historicVariableInstanceDataManager) {
<span class="nc" id="L36">        super(variableServiceConfiguration, variableServiceConfiguration.getEngineName(), historicVariableInstanceDataManager);</span>
<span class="nc" id="L37">    }</span>

    @Override
    public HistoricVariableInstanceEntity create(VariableInstanceEntity variableInstance, Date createTime) {
<span class="nc" id="L41">        HistoricVariableInstanceEntity historicVariableInstance = dataManager.create();</span>
<span class="nc" id="L42">        historicVariableInstance.setId(variableInstance.getId());</span>
<span class="nc" id="L43">        historicVariableInstance.setRevision(variableInstance.getRevision());</span>

<span class="nc" id="L45">        copyVariableFields(historicVariableInstance, variableInstance, createTime);</span>

<span class="nc" id="L47">        historicVariableInstance.setCreateTime(createTime);</span>
<span class="nc" id="L48">        historicVariableInstance.setLastUpdatedTime(createTime);</span>

<span class="nc" id="L50">        return historicVariableInstance;</span>
    }

    @Override
    public HistoricVariableInstanceEntity createAndInsert(VariableInstanceEntity variableInstance, Date createTime) {
<span class="nc" id="L55">        HistoricVariableInstanceEntity historicVariableInstance = create(variableInstance, createTime);</span>

<span class="nc" id="L57">        insert(historicVariableInstance);</span>

<span class="nc" id="L59">        return historicVariableInstance;</span>
    }

    @Override
    public void copyVariableFields(HistoricVariableInstanceEntity historicVariableInstance, VariableInstanceEntity variableInstance, Date updateTime) {
<span class="nc" id="L64">        historicVariableInstance.setProcessInstanceId(variableInstance.getProcessInstanceId());</span>
<span class="nc" id="L65">        historicVariableInstance.setExecutionId(variableInstance.getExecutionId());</span>
<span class="nc" id="L66">        historicVariableInstance.setTaskId(variableInstance.getTaskId());</span>
<span class="nc" id="L67">        historicVariableInstance.setName(variableInstance.getName());</span>
<span class="nc" id="L68">        historicVariableInstance.setVariableType(variableInstance.getType());</span>
<span class="nc" id="L69">        historicVariableInstance.setScopeId(variableInstance.getScopeId());</span>
<span class="nc" id="L70">        historicVariableInstance.setSubScopeId(variableInstance.getSubScopeId());</span>
<span class="nc" id="L71">        historicVariableInstance.setScopeType(variableInstance.getScopeType());</span>
<span class="nc" id="L72">        historicVariableInstance.setMetaInfo(variableInstance.getMetaInfo());</span>

<span class="nc" id="L74">        copyVariableValue(historicVariableInstance, variableInstance, updateTime);</span>
<span class="nc" id="L75">    }</span>

    @Override
    public void copyVariableValue(HistoricVariableInstanceEntity historicVariableInstance, VariableInstanceEntity variableInstance, Date updateTime) {
<span class="nc" id="L79">        historicVariableInstance.setTextValue(variableInstance.getTextValue());</span>
<span class="nc" id="L80">        historicVariableInstance.setTextValue2(variableInstance.getTextValue2());</span>
<span class="nc" id="L81">        historicVariableInstance.setDoubleValue(variableInstance.getDoubleValue());</span>
<span class="nc" id="L82">        historicVariableInstance.setLongValue(variableInstance.getLongValue());</span>

<span class="nc" id="L84">        historicVariableInstance.setVariableType(variableInstance.getType());</span>
<span class="nc bnc" id="L85" title="All 2 branches missed.">        if (variableInstance.getByteArrayRef() != null) {</span>
<span class="nc" id="L86">            historicVariableInstance.setBytes(variableInstance.getBytes());</span>
        }

<span class="nc" id="L89">        historicVariableInstance.setLastUpdatedTime(updateTime);</span>
<span class="nc" id="L90">    }</span>

    @Override
    public void delete(HistoricVariableInstanceEntity entity, boolean fireDeleteEvent) {
<span class="nc" id="L94">        super.delete(entity, fireDeleteEvent);</span>

<span class="nc bnc" id="L96" title="All 2 branches missed.">        if (entity.getByteArrayRef() != null) {</span>
<span class="nc" id="L97">            entity.getByteArrayRef().delete(serviceConfiguration.getEngineName());</span>
        }
<span class="nc" id="L99">    }</span>

    @Override
    public void deleteHistoricVariableInstanceByProcessInstanceId(final String historicProcessInstanceId) {
<span class="nc" id="L103">        List&lt;HistoricVariableInstanceEntity&gt; historicProcessVariables = dataManager.findHistoricVariableInstancesByProcessInstanceId(historicProcessInstanceId);</span>
<span class="nc bnc" id="L104" title="All 2 branches missed.">        for (HistoricVariableInstanceEntity historicProcessVariable : historicProcessVariables) {</span>
<span class="nc" id="L105">            delete(historicProcessVariable);</span>
<span class="nc" id="L106">        }</span>
<span class="nc" id="L107">    }</span>

    @Override
    public long findHistoricVariableInstanceCountByQueryCriteria(HistoricVariableInstanceQueryImpl historicProcessVariableQuery) {
<span class="nc" id="L111">        return dataManager.findHistoricVariableInstanceCountByQueryCriteria(historicProcessVariableQuery);</span>
    }

    @Override
    public List&lt;HistoricVariableInstance&gt; findHistoricVariableInstancesByQueryCriteria(HistoricVariableInstanceQueryImpl historicProcessVariableQuery) {
<span class="nc" id="L116">        return dataManager.findHistoricVariableInstancesByQueryCriteria(historicProcessVariableQuery);</span>
    }

    @Override
    public HistoricVariableInstanceEntity findHistoricVariableInstanceByVariableInstanceId(String variableInstanceId) {
<span class="nc" id="L121">        return dataManager.findHistoricVariableInstanceByVariableInstanceId(variableInstanceId);</span>
    }
    
    @Override
    public List&lt;HistoricVariableInstanceEntity&gt; findHistoricalVariableInstancesByProcessInstanceId(String processInstanceId) {
<span class="nc" id="L126">        return dataManager.findHistoricVariableInstancesByProcessInstanceId(processInstanceId);</span>
    }

    @Override
    public List&lt;HistoricVariableInstanceEntity&gt; findHistoricalVariableInstancesByTaskId(String taskId) {
<span class="nc" id="L131">        return dataManager.findHistoricVariableInstancesByTaskId(taskId);</span>
    }

    @Override
    public List&lt;HistoricVariableInstanceEntity&gt; findHistoricalVariableInstancesByScopeIdAndScopeType(String scopeId, String scopeType) {
<span class="nc" id="L136">        return dataManager.findHistoricalVariableInstancesByScopeIdAndScopeType(scopeId, scopeType);</span>
    }
    
    @Override
    public List&lt;HistoricVariableInstanceEntity&gt; findHistoricalVariableInstancesBySubScopeIdAndScopeType(String subScopeId, String scopeType) {
<span class="nc" id="L141">        return dataManager.findHistoricalVariableInstancesBySubScopeIdAndScopeType(subScopeId, scopeType);</span>
    }

    @Override
    public void deleteHistoricVariableInstancesByTaskId(String taskId) {
<span class="nc" id="L146">        List&lt;HistoricVariableInstanceEntity&gt; historicProcessVariables = dataManager.findHistoricVariableInstancesByTaskId(taskId);</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">        for (HistoricVariableInstanceEntity historicProcessVariable : historicProcessVariables) {</span>
<span class="nc" id="L148">            delete(historicProcessVariable);</span>
<span class="nc" id="L149">        }</span>
<span class="nc" id="L150">    }</span>

    @Override
    public void bulkDeleteHistoricVariableInstancesByProcessInstanceIds(Collection&lt;String&gt; processInstanceIds) {
<span class="nc" id="L154">        dataManager.bulkDeleteHistoricVariableInstancesByProcessInstanceIds(processInstanceIds);</span>
<span class="nc" id="L155">    }</span>

    @Override
    public void bulkDeleteHistoricVariableInstancesByTaskIds(Collection&lt;String&gt; taskIds) {
<span class="nc" id="L159">        dataManager.bulkDeleteHistoricVariableInstancesByTaskIds(taskIds);</span>
<span class="nc" id="L160">    }</span>

    @Override
    public void bulkDeleteHistoricVariableInstancesByScopeIdsAndScopeType(Collection&lt;String&gt; scopeIds, String scopeType) {
<span class="nc" id="L164">        dataManager.bulkDeleteHistoricVariableInstancesByScopeIdsAndScopeType(scopeIds, scopeType);</span>
<span class="nc" id="L165">    }</span>

    @Override
    public void deleteHistoricVariableInstancesForNonExistingProcessInstances() {
<span class="nc" id="L169">        dataManager.deleteHistoricVariableInstancesForNonExistingProcessInstances();</span>
<span class="nc" id="L170">    }</span>
    
    @Override
    public void deleteHistoricVariableInstancesForNonExistingCaseInstances() {
<span class="nc" id="L174">        dataManager.deleteHistoricVariableInstancesForNonExistingCaseInstances();</span>
<span class="nc" id="L175">    }</span>

    @Override
    public List&lt;HistoricVariableInstance&gt; findHistoricVariableInstancesByNativeQuery(Map&lt;String, Object&gt; parameterMap) {
<span class="nc" id="L179">        return dataManager.findHistoricVariableInstancesByNativeQuery(parameterMap);</span>
    }

    @Override
    public long findHistoricVariableInstanceCountByNativeQuery(Map&lt;String, Object&gt; parameterMap) {
<span class="nc" id="L184">        return dataManager.findHistoricVariableInstanceCountByNativeQuery(parameterMap);</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>