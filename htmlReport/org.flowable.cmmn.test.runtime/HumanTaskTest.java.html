<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>HumanTaskTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jacoco.exec</a> &gt; <a href="index.source.html" class="el_package">org.flowable.cmmn.test.runtime</a> &gt; <span class="el_source">HumanTaskTest.java</span></div><h1>HumanTaskTest.java</h1><pre class="source lang-java linenums">/* Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.flowable.cmmn.test.runtime;

import static org.assertj.core.api.Assertions.assertThat;
import static org.assertj.core.api.Assertions.tuple;

import java.util.Arrays;
import java.util.Calendar;
import java.util.Collections;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.flowable.cmmn.api.history.HistoricPlanItemInstance;
import org.flowable.cmmn.api.repository.CaseDefinition;
import org.flowable.cmmn.api.runtime.CaseInstance;
import org.flowable.cmmn.api.runtime.PlanItemDefinitionType;
import org.flowable.cmmn.api.runtime.PlanItemInstance;
import org.flowable.cmmn.engine.test.CmmnDeployment;
import org.flowable.cmmn.engine.test.FlowableCmmnTestCase;
import org.flowable.cmmn.engine.test.impl.CmmnHistoryTestHelper;
import org.flowable.cmmn.engine.test.impl.CmmnJobTestHelper;
import org.flowable.cmmn.engine.test.impl.CmmnTestHelper;
import org.flowable.common.engine.api.constant.ReferenceTypes;
import org.flowable.common.engine.api.scope.ScopeTypes;
import org.flowable.common.engine.impl.history.HistoryLevel;
import org.flowable.common.engine.impl.identity.Authentication;
import org.flowable.common.engine.impl.interceptor.Command;
import org.flowable.common.engine.impl.interceptor.CommandContext;
import org.flowable.entitylink.api.EntityLink;
import org.flowable.entitylink.api.EntityLinkType;
import org.flowable.entitylink.api.HierarchyType;
import org.flowable.entitylink.api.history.HistoricEntityLink;
import org.flowable.identitylink.api.IdentityLink;
import org.flowable.identitylink.api.IdentityLinkType;
import org.flowable.identitylink.api.history.HistoricIdentityLink;
import org.flowable.job.service.JobHandler;
import org.flowable.job.service.TimerJobService;
import org.flowable.job.service.impl.persistence.entity.JobEntity;
import org.flowable.job.service.impl.persistence.entity.TimerJobEntity;
import org.flowable.task.api.Task;
import org.flowable.task.api.history.HistoricTaskInstance;
import org.junit.Test;

import com.fasterxml.jackson.databind.node.ArrayNode;

/**
 * @author Tijs Rademakers
 * @author Joram Barrez
 */
<span class="nc" id="L62">public class HumanTaskTest extends FlowableCmmnTestCase {</span>

    @Test
    @CmmnDeployment
    public void testHumanTask() {
<span class="nc" id="L67">        Authentication.setAuthenticatedUserId(&quot;JohnDoe&quot;);</span>

<span class="nc" id="L69">        CaseInstance caseInstance = cmmnRuntimeService.createCaseInstanceBuilder()</span>
<span class="nc" id="L70">                        .caseDefinitionKey(&quot;myCase&quot;)</span>
<span class="nc" id="L71">                        .start();</span>
<span class="nc" id="L72">        assertThat(caseInstance).isNotNull();</span>

<span class="nc" id="L74">        Task task = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).singleResult();</span>
<span class="nc" id="L75">        assertThat(task.getName()).isEqualTo(&quot;Task One&quot;);</span>
<span class="nc" id="L76">        assertThat(task.getAssignee()).isEqualTo(&quot;JohnDoe&quot;);</span>
<span class="nc" id="L77">        String task1Id = task.getId();</span>
        
<span class="nc" id="L79">        List&lt;EntityLink&gt; entityLinks = cmmnRuntimeService.getEntityLinkChildrenForCaseInstance(caseInstance.getId());</span>
<span class="nc" id="L80">        assertThat(entityLinks).hasSize(1);</span>
<span class="nc" id="L81">        EntityLink entityLink = entityLinks.get(0);</span>
<span class="nc" id="L82">        assertThat(entityLink.getLinkType()).isEqualTo(EntityLinkType.CHILD);</span>
<span class="nc" id="L83">        assertThat(entityLink.getCreateTime()).isNotNull();</span>
<span class="nc" id="L84">        assertThat(entityLink.getScopeId()).isEqualTo(caseInstance.getId());</span>
<span class="nc" id="L85">        assertThat(entityLink.getScopeType()).isEqualTo(ScopeTypes.CMMN);</span>
<span class="nc" id="L86">        assertThat(entityLink.getScopeDefinitionId()).isNull();</span>
<span class="nc" id="L87">        assertThat(entityLink.getReferenceScopeId()).isEqualTo(task.getId());</span>
<span class="nc" id="L88">        assertThat(entityLink.getReferenceScopeType()).isEqualTo(ScopeTypes.TASK);</span>
<span class="nc" id="L89">        assertThat(entityLink.getReferenceScopeDefinitionId()).isNull();</span>
<span class="nc" id="L90">        assertThat(entityLink.getHierarchyType()).isEqualTo(HierarchyType.ROOT);</span>

<span class="nc" id="L92">        assertThat(cmmnTaskService.getIdentityLinksForTask(task1Id))</span>
<span class="nc" id="L93">            .extracting(IdentityLink::getType, IdentityLink::getUserId, IdentityLink::getGroupId)</span>
<span class="nc" id="L94">            .containsExactlyInAnyOrder(</span>
<span class="nc" id="L95">                tuple(&quot;assignee&quot;, &quot;JohnDoe&quot;, null)</span>
            );

<span class="nc" id="L98">        PlanItemInstance taskPlanItemInstance = cmmnRuntimeService.createPlanItemInstanceQuery()</span>
<span class="nc" id="L99">                .planItemDefinitionType(PlanItemDefinitionType.HUMAN_TASK)</span>
<span class="nc" id="L100">                .planItemInstanceStateActive()</span>
<span class="nc" id="L101">                .singleResult();</span>
<span class="nc" id="L102">        assertThat(taskPlanItemInstance).isNotNull();</span>
<span class="nc" id="L103">        assertThat(taskPlanItemInstance.getReferenceId()).isEqualTo(task.getId());</span>
<span class="nc" id="L104">        assertThat(taskPlanItemInstance.getReferenceType()).isEqualTo(ReferenceTypes.PLAN_ITEM_CHILD_HUMAN_TASK);</span>

<span class="nc bnc" id="L106" title="All 2 branches missed.">        if (CmmnHistoryTestHelper.isHistoryLevelAtLeast(HistoryLevel.ACTIVITY, cmmnEngineConfiguration)) {</span>
<span class="nc" id="L107">            HistoricPlanItemInstance historicTaskPlanItemInstance = cmmnHistoryService.createHistoricPlanItemInstanceQuery()</span>
<span class="nc" id="L108">                    .planItemInstanceId(taskPlanItemInstance.getId())</span>
<span class="nc" id="L109">                    .singleResult();</span>

<span class="nc" id="L111">            assertThat(historicTaskPlanItemInstance.getReferenceId()).isEqualTo(task.getId());</span>
<span class="nc" id="L112">            assertThat(historicTaskPlanItemInstance.getReferenceType()).isEqualTo(ReferenceTypes.PLAN_ITEM_CHILD_HUMAN_TASK);</span>
        }

<span class="nc" id="L115">        cmmnTaskService.complete(task.getId());</span>

<span class="nc" id="L117">        task = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).singleResult();</span>
<span class="nc" id="L118">        assertThat(task.getName()).isEqualTo(&quot;Task Two&quot;);</span>
<span class="nc" id="L119">        assertThat(task.getAssignee()).isNull();</span>
<span class="nc" id="L120">        String task2Id = task.getId();</span>

<span class="nc" id="L122">        task = cmmnTaskService.createTaskQuery().taskCandidateGroup(&quot;test&quot;).caseInstanceId(caseInstance.getId()).singleResult();</span>
<span class="nc" id="L123">        assertThat(task.getName()).isEqualTo(&quot;Task Two&quot;);</span>

<span class="nc" id="L125">        task = cmmnTaskService.createTaskQuery().taskCandidateUser(&quot;test2&quot;).caseInstanceId(caseInstance.getId()).singleResult();</span>
<span class="nc" id="L126">        assertThat(task.getName()).isEqualTo(&quot;Task Two&quot;);</span>

<span class="nc" id="L128">        assertThat(cmmnTaskService.getIdentityLinksForTask(task2Id))</span>
<span class="nc" id="L129">            .extracting(IdentityLink::getType, IdentityLink::getUserId, IdentityLink::getGroupId)</span>
<span class="nc" id="L130">            .containsExactlyInAnyOrder(</span>
<span class="nc" id="L131">                tuple(&quot;candidate&quot;, &quot;test&quot;, null),</span>
<span class="nc" id="L132">                tuple(&quot;candidate&quot;, &quot;test2&quot;, null),</span>
<span class="nc" id="L133">                tuple(&quot;candidate&quot;, null, &quot;test&quot;)</span>
            );

<span class="nc" id="L136">        cmmnTaskService.complete(task.getId());</span>

<span class="nc" id="L138">        assertThat(cmmnRuntimeService.createCaseInstanceQuery().count()).isZero();</span>

<span class="nc bnc" id="L140" title="All 2 branches missed.">        if (CmmnHistoryTestHelper.isHistoryLevelAtLeast(HistoryLevel.ACTIVITY, cmmnEngineConfiguration)) {</span>
<span class="nc" id="L141">            assertThat(cmmnHistoryService.createHistoricVariableInstanceQuery()</span>
<span class="nc" id="L142">                    .caseInstanceId(caseInstance.getId())</span>
<span class="nc" id="L143">                    .variableName(&quot;var1&quot;)</span>
<span class="nc" id="L144">                    .singleResult().getValue()).isEqualTo(&quot;JohnDoe&quot;);</span>

<span class="nc" id="L146">            List&lt;HistoricEntityLink&gt; historicEntityLinks = cmmnHistoryService.getHistoricEntityLinkChildrenForCaseInstance(caseInstance.getId());</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">            for (HistoricEntityLink historicEntityLink : historicEntityLinks) {</span>
<span class="nc" id="L148">                assertThat(historicEntityLink.getLinkType()).isEqualTo(EntityLinkType.CHILD);</span>
<span class="nc" id="L149">                assertThat(historicEntityLink.getCreateTime()).isNotNull();</span>
<span class="nc" id="L150">                assertThat(historicEntityLink.getScopeId()).isEqualTo(caseInstance.getId());</span>
<span class="nc" id="L151">                assertThat(historicEntityLink.getScopeType()).isEqualTo(ScopeTypes.CMMN);</span>
<span class="nc" id="L152">                assertThat(historicEntityLink.getScopeDefinitionId()).isNull();</span>
<span class="nc" id="L153">                assertThat(historicEntityLink.getReferenceScopeType()).isEqualTo(ScopeTypes.TASK);</span>
<span class="nc" id="L154">                assertThat(historicEntityLink.getReferenceScopeDefinitionId()).isNull();</span>
<span class="nc" id="L155">                assertThat(entityLink.getHierarchyType()).isEqualTo(HierarchyType.ROOT);</span>
<span class="nc" id="L156">            }</span>

<span class="nc" id="L158">            assertThat(historicEntityLinks)</span>
<span class="nc" id="L159">                    .extracting(HistoricEntityLink::getReferenceScopeId)</span>
<span class="nc" id="L160">                    .containsExactlyInAnyOrder(task1Id, task2Id);</span>

<span class="nc" id="L162">            assertThat(cmmnHistoryService.getHistoricIdentityLinksForTask(task1Id))</span>
<span class="nc" id="L163">                .extracting(HistoricIdentityLink::getType, HistoricIdentityLink::getUserId, HistoricIdentityLink::getGroupId)</span>
<span class="nc" id="L164">                .containsExactlyInAnyOrder(</span>
<span class="nc" id="L165">                    tuple(&quot;assignee&quot;, &quot;JohnDoe&quot;, null)</span>
                );

<span class="nc" id="L168">            assertThat(cmmnHistoryService.getHistoricIdentityLinksForTask(task2Id))</span>
<span class="nc" id="L169">                .extracting(HistoricIdentityLink::getType, HistoricIdentityLink::getUserId, HistoricIdentityLink::getGroupId)</span>
<span class="nc" id="L170">                .containsExactlyInAnyOrder(</span>
<span class="nc" id="L171">                    tuple(&quot;candidate&quot;, &quot;test&quot;, null),</span>
<span class="nc" id="L172">                    tuple(&quot;candidate&quot;, &quot;test2&quot;, null),</span>
<span class="nc" id="L173">                    tuple(&quot;candidate&quot;, null, &quot;test&quot;)</span>
                );
        }

<span class="nc" id="L177">        Authentication.setAuthenticatedUserId(null);</span>
<span class="nc" id="L178">    }</span>

    @Test
    public void testCreateHumanTaskUnderTenantByKey() {
<span class="nc" id="L182">        Authentication.setAuthenticatedUserId(&quot;JohnDoe&quot;);</span>
<span class="nc" id="L183">        org.flowable.cmmn.api.repository.CmmnDeployment deployment = cmmnRepositoryService.createDeployment().tenantId(&quot;flowable&quot;).</span>
<span class="nc" id="L184">                addClasspathResource(&quot;org/flowable/cmmn/test/runtime/HumanTaskTest.testHumanTask.cmmn&quot;).deploy();</span>
        try {
<span class="nc" id="L186">            assertThat(deployment.getTenantId()).isEqualTo(&quot;flowable&quot;);</span>

<span class="nc" id="L188">            CaseInstance caseInstance = cmmnRuntimeService.createCaseInstanceBuilder()</span>
<span class="nc" id="L189">                    .caseDefinitionKey(&quot;myCase&quot;)</span>
<span class="nc" id="L190">                    .tenantId(&quot;flowable&quot;)</span>
<span class="nc" id="L191">                    .start();</span>
<span class="nc" id="L192">            assertThat(caseInstance).isNotNull();</span>
<span class="nc" id="L193">            assertThat(caseInstance.getTenantId()).isEqualTo(&quot;flowable&quot;);</span>

<span class="nc" id="L195">            Task task = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).singleResult();</span>
<span class="nc" id="L196">            assertThat(task.getName()).isEqualTo(&quot;Task One&quot;);</span>
<span class="nc" id="L197">            assertThat(task.getAssignee()).isEqualTo(&quot;JohnDoe&quot;);</span>
<span class="nc" id="L198">            assertThat(task.getTenantId()).isEqualTo(&quot;flowable&quot;);</span>

<span class="nc" id="L200">            cmmnTaskService.complete(task.getId());</span>

<span class="nc" id="L202">            task = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).singleResult();</span>
<span class="nc" id="L203">            assertThat(task.getName()).isEqualTo(&quot;Task Two&quot;);</span>
<span class="nc" id="L204">            assertThat(task.getTenantId()).isEqualTo(&quot;flowable&quot;);</span>
<span class="nc" id="L205">            cmmnTaskService.complete(task.getId());</span>

<span class="nc" id="L207">            assertThat(cmmnRuntimeService.createCaseInstanceQuery().count()).isZero();</span>

        } finally {
<span class="nc" id="L210">            CmmnTestHelper.deleteDeployment(cmmnEngineConfiguration, deployment.getId());</span>
<span class="nc" id="L211">            Authentication.setAuthenticatedUserId(null);</span>
        }

<span class="nc" id="L214">    }</span>

    @Test
    public void testCreateHumanTaskUnderTenantById() {
<span class="nc" id="L218">        Authentication.setAuthenticatedUserId(&quot;JohnDoe&quot;);</span>
<span class="nc" id="L219">        org.flowable.cmmn.api.repository.CmmnDeployment deployment = cmmnRepositoryService.createDeployment().tenantId(&quot;flowable&quot;).</span>
<span class="nc" id="L220">                addClasspathResource(&quot;org/flowable/cmmn/test/runtime/HumanTaskTest.testHumanTask.cmmn&quot;).deploy();</span>
        try {
<span class="nc" id="L222">            assertThat(deployment.getTenantId()).isEqualTo(&quot;flowable&quot;);</span>
<span class="nc" id="L223">            CaseDefinition caseDefinition = cmmnRepositoryService.createCaseDefinitionQuery().deploymentId(deployment.getId()).singleResult();</span>
<span class="nc" id="L224">            assertThat(caseDefinition.getTenantId()).isEqualTo(&quot;flowable&quot;);</span>

<span class="nc" id="L226">            CaseInstance caseInstance = cmmnRuntimeService.createCaseInstanceBuilder()</span>
<span class="nc" id="L227">                    .caseDefinitionId(caseDefinition.getId())</span>
<span class="nc" id="L228">                    .tenantId(&quot;flowable&quot;)</span>
<span class="nc" id="L229">                    .start();</span>
<span class="nc" id="L230">            assertThat(caseInstance).isNotNull();</span>
<span class="nc" id="L231">            assertThat(caseInstance.getTenantId()).isEqualTo(&quot;flowable&quot;);</span>

<span class="nc" id="L233">            Task task = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).singleResult();</span>
<span class="nc" id="L234">            assertThat(task.getName()).isEqualTo(&quot;Task One&quot;);</span>
<span class="nc" id="L235">            assertThat(task.getAssignee()).isEqualTo(&quot;JohnDoe&quot;);</span>
<span class="nc" id="L236">            assertThat(task.getTenantId()).isEqualTo(&quot;flowable&quot;);</span>

<span class="nc" id="L238">            cmmnTaskService.complete(task.getId());</span>

<span class="nc" id="L240">            task = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).singleResult();</span>
<span class="nc" id="L241">            assertThat(task.getTenantId()).isEqualTo(&quot;flowable&quot;);</span>
<span class="nc" id="L242">            cmmnTaskService.complete(task.getId());</span>

<span class="nc" id="L244">            assertThat(cmmnRuntimeService.createCaseInstanceQuery().count()).isZero();</span>
        } finally {
<span class="nc" id="L246">            CmmnTestHelper.deleteDeployment(cmmnEngineConfiguration, deployment.getId());</span>
<span class="nc" id="L247">            Authentication.setAuthenticatedUserId(null);</span>
        }

<span class="nc" id="L250">    }</span>

    @Test
    @CmmnDeployment
    public void testTaskCompletionExitsStage() {
<span class="nc" id="L255">        CaseInstance caseInstance = cmmnRuntimeService.createCaseInstanceBuilder()</span>
<span class="nc" id="L256">                .caseDefinitionKey(&quot;humanTaskCompletionExits&quot;)</span>
<span class="nc" id="L257">                .start();</span>
<span class="nc" id="L258">        assertThat(caseInstance).isNotNull();</span>

<span class="nc" id="L260">        List&lt;Task&gt; tasks = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).orderByTaskName().asc().list();</span>
<span class="nc" id="L261">        assertThat(tasks)</span>
<span class="nc" id="L262">                .extracting(Task::getName)</span>
<span class="nc" id="L263">                .containsExactly(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;);</span>

        // Completing A should delete B and C
<span class="nc" id="L266">        cmmnTaskService.complete(tasks.get(0).getId());</span>
<span class="nc" id="L267">        assertThat(cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).count()).isZero();</span>
<span class="nc" id="L268">        assertCaseInstanceEnded(caseInstance);</span>

<span class="nc bnc" id="L270" title="All 2 branches missed.">        if (CmmnHistoryTestHelper.isHistoryLevelAtLeast(HistoryLevel.ACTIVITY, cmmnEngineConfiguration)) {</span>
<span class="nc" id="L271">            List&lt;HistoricTaskInstance&gt; historicTaskInstances = cmmnHistoryService.createHistoricTaskInstanceQuery().list();</span>
<span class="nc" id="L272">            assertThat(historicTaskInstances).hasSize(3);</span>
<span class="nc bnc" id="L273" title="All 2 branches missed.">            for (HistoricTaskInstance historicTaskInstance : historicTaskInstances) {</span>
<span class="nc" id="L274">                assertThat(historicTaskInstance.getStartTime()).isNotNull();</span>
<span class="nc" id="L275">                assertThat(historicTaskInstance.getEndTime()).isNotNull();</span>
<span class="nc bnc" id="L276" title="All 2 branches missed.">                if (!&quot;A&quot;.equals(historicTaskInstance.getName())) {</span>
<span class="nc" id="L277">                    assertThat(historicTaskInstance.getDeleteReason()).isEqualTo(&quot;cmmn-state-transition-terminate-case&quot;);</span>
                }
<span class="nc" id="L279">            }</span>
        }

        // Completing C should delete B
<span class="nc" id="L283">        CaseInstance caseInstance2 = cmmnRuntimeService.createCaseInstanceBuilder()</span>
<span class="nc" id="L284">                .caseDefinitionKey(&quot;humanTaskCompletionExits&quot;)</span>
<span class="nc" id="L285">                .start();</span>
<span class="nc" id="L286">        assertThat(caseInstance2).isNotNull();</span>
<span class="nc" id="L287">        tasks = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance2.getId()).orderByTaskName().asc().list();</span>
<span class="nc" id="L288">        cmmnTaskService.complete(tasks.get(2).getId());</span>

<span class="nc" id="L290">        Task taskA = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance2.getId()).orderByTaskName().asc().singleResult();</span>
<span class="nc" id="L291">        assertThat(taskA).isNotNull();</span>
<span class="nc" id="L292">        cmmnTaskService.complete(taskA.getId());</span>
<span class="nc" id="L293">        assertCaseInstanceEnded(caseInstance2);</span>

<span class="nc bnc" id="L295" title="All 2 branches missed.">        if (CmmnHistoryTestHelper.isHistoryLevelAtLeast(HistoryLevel.ACTIVITY, cmmnEngineConfiguration)) {</span>
<span class="nc" id="L296">            List&lt;HistoricTaskInstance&gt; historicTaskInstances = cmmnHistoryService.createHistoricTaskInstanceQuery().caseInstanceId(caseInstance2.getId()).list();</span>
<span class="nc" id="L297">            assertThat(historicTaskInstances).hasSize(3);</span>
<span class="nc bnc" id="L298" title="All 2 branches missed.">            for (HistoricTaskInstance historicTaskInstance : historicTaskInstances) {</span>
<span class="nc" id="L299">                assertThat(historicTaskInstance.getStartTime()).isNotNull();</span>
<span class="nc" id="L300">                assertThat(historicTaskInstance.getEndTime()).isNotNull();</span>
<span class="nc bnc" id="L301" title="All 2 branches missed.">                if (&quot;B&quot;.equals(historicTaskInstance.getName())) {</span>
<span class="nc" id="L302">                    assertThat(historicTaskInstance.getDeleteReason()).isEqualTo(&quot;cmmn-state-transition-exit&quot;);</span>
                }
<span class="nc" id="L304">            }</span>
        }
<span class="nc" id="L306">    }</span>

    @Test
    @CmmnDeployment(resources = &quot;org/flowable/cmmn/test/runtime/HumanTaskTest.testHumanTask.cmmn&quot;)
    public void addCompleteAuthenticatedUserAsParticipantToParentCase() {
<span class="nc" id="L311">        CaseInstance caseInstance = cmmnRuntimeService.createCaseInstanceBuilder()</span>
<span class="nc" id="L312">            .caseDefinitionKey(&quot;myCase&quot;)</span>
<span class="nc" id="L313">            .start();</span>
<span class="nc" id="L314">        assertThat(caseInstance).isNotNull();</span>


<span class="nc" id="L317">        Task task = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).singleResult();</span>
<span class="nc" id="L318">        assertThat(task.getName()).isEqualTo(&quot;Task One&quot;);</span>
<span class="nc" id="L319">        assertThat(task.getAssignee()).isNull();</span>

<span class="nc" id="L321">        assertThat(cmmnRuntimeService.getIdentityLinksForCaseInstance(caseInstance.getId())).isEmpty();</span>

<span class="nc" id="L323">        String prevUserId = Authentication.getAuthenticatedUserId();</span>
<span class="nc" id="L324">        Authentication.setAuthenticatedUserId(&quot;JohnDoe&quot;);</span>
        try {
<span class="nc" id="L326">            cmmnTaskService.complete(task.getId());</span>
        } finally {
<span class="nc" id="L328">            Authentication.setAuthenticatedUserId(prevUserId);</span>
        }

<span class="nc" id="L331">        assertThat(cmmnRuntimeService.getIdentityLinksForCaseInstance(caseInstance.getId()))</span>
<span class="nc" id="L332">            .extracting(IdentityLink::getType, IdentityLink::getUserId, IdentityLink::getGroupId)</span>
<span class="nc" id="L333">            .containsExactlyInAnyOrder(</span>
<span class="nc" id="L334">                tuple(IdentityLinkType.PARTICIPANT, &quot;JohnDoe&quot;, null),</span>
<span class="nc" id="L335">                tuple(IdentityLinkType.PARTICIPANT, &quot;test&quot;, null),</span>
<span class="nc" id="L336">                tuple(IdentityLinkType.PARTICIPANT, &quot;test2&quot;, null)</span>
            );
<span class="nc" id="L338">    }</span>

    @Test
    @CmmnDeployment(resources = &quot;org/flowable/cmmn/test/runtime/HumanTaskTest.testHumanTaskCandidatesExpression.cmmn&quot;)
    public void humanTaskWithCollectionExpressionCandidates() {
<span class="nc" id="L343">        cmmnRuntimeService.createCaseInstanceBuilder()</span>
<span class="nc" id="L344">                .caseDefinitionKey(&quot;myCase&quot;)</span>
<span class="nc" id="L345">                .transientVariable(&quot;userVar&quot;, Arrays.asList(&quot;kermit&quot;, &quot;gonzo&quot;))</span>
<span class="nc" id="L346">                .transientVariable(&quot;groupVar&quot;, Collections.singletonList(&quot;management&quot;))</span>
<span class="nc" id="L347">                .start();</span>

<span class="nc" id="L349">        Task task = cmmnTaskService.createTaskQuery().singleResult();</span>
<span class="nc" id="L350">        assertThat(task).isNotNull();</span>

<span class="nc" id="L352">        assertThat(cmmnTaskService.getIdentityLinksForTask(task.getId()))</span>
<span class="nc" id="L353">                .extracting(IdentityLink::getType, IdentityLink::getUserId, IdentityLink::getGroupId)</span>
<span class="nc" id="L354">                .containsExactlyInAnyOrder(</span>
<span class="nc" id="L355">                        tuple(IdentityLinkType.CANDIDATE, &quot;kermit&quot;, null),</span>
<span class="nc" id="L356">                        tuple(IdentityLinkType.CANDIDATE, &quot;gonzo&quot;, null),</span>
<span class="nc" id="L357">                        tuple(IdentityLinkType.CANDIDATE, null, &quot;management&quot;)</span>
                );
<span class="nc" id="L359">    }</span>

    @Test
    @CmmnDeployment(resources = &quot;org/flowable/cmmn/test/runtime/HumanTaskTest.testHumanTaskCandidatesExpression.cmmn&quot;)
    public void humanTaskWithArrayNodeExpressionCandidates() {
<span class="nc" id="L364">        ArrayNode userVar = cmmnEngineConfiguration.getObjectMapper().createArrayNode();</span>
<span class="nc" id="L365">        userVar.add(&quot;kermit&quot;);</span>
<span class="nc" id="L366">        ArrayNode groupVar = cmmnEngineConfiguration.getObjectMapper().createArrayNode();</span>
<span class="nc" id="L367">        groupVar.add(&quot;management&quot;).add(&quot;sales&quot;);</span>
<span class="nc" id="L368">        cmmnRuntimeService.createCaseInstanceBuilder()</span>
<span class="nc" id="L369">                .caseDefinitionKey(&quot;myCase&quot;)</span>
<span class="nc" id="L370">                .transientVariable(&quot;userVar&quot;, userVar)</span>
<span class="nc" id="L371">                .transientVariable(&quot;groupVar&quot;, groupVar)</span>
<span class="nc" id="L372">                .start();</span>

<span class="nc" id="L374">        Task task = cmmnTaskService.createTaskQuery().singleResult();</span>
<span class="nc" id="L375">        assertThat(task).isNotNull();</span>

<span class="nc" id="L377">        assertThat(cmmnTaskService.getIdentityLinksForTask(task.getId()))</span>
<span class="nc" id="L378">                .extracting(IdentityLink::getType, IdentityLink::getUserId, IdentityLink::getGroupId)</span>
<span class="nc" id="L379">                .containsExactlyInAnyOrder(</span>
<span class="nc" id="L380">                        tuple(IdentityLinkType.CANDIDATE, &quot;kermit&quot;, null),</span>
<span class="nc" id="L381">                        tuple(IdentityLinkType.CANDIDATE, null, &quot;management&quot;),</span>
<span class="nc" id="L382">                        tuple(IdentityLinkType.CANDIDATE, null, &quot;sales&quot;)</span>
                );
<span class="nc" id="L384">    }</span>

    @Test
    @CmmnDeployment
    public void humanTaskWithCommaSeparatedStringExpressionCandidates() {
<span class="nc" id="L389">        cmmnRuntimeService.createCaseInstanceBuilder()</span>
<span class="nc" id="L390">                .caseDefinitionKey(&quot;myCase&quot;)</span>
<span class="nc" id="L391">                .start();</span>

<span class="nc" id="L393">        Task task = cmmnTaskService.createTaskQuery().singleResult();</span>
<span class="nc" id="L394">        assertThat(task).isNotNull();</span>

<span class="nc" id="L396">        assertThat(cmmnTaskService.getIdentityLinksForTask(task.getId()))</span>
<span class="nc" id="L397">                .extracting(IdentityLink::getType, IdentityLink::getUserId, IdentityLink::getGroupId)</span>
<span class="nc" id="L398">                .containsExactlyInAnyOrder(</span>
<span class="nc" id="L399">                        tuple(IdentityLinkType.CANDIDATE, &quot;user1&quot;, null),</span>
<span class="nc" id="L400">                        tuple(IdentityLinkType.CANDIDATE, &quot;user2&quot;, null),</span>
<span class="nc" id="L401">                        tuple(IdentityLinkType.CANDIDATE, null, &quot;groupA&quot;),</span>
<span class="nc" id="L402">                        tuple(IdentityLinkType.CANDIDATE, null, &quot;groupB&quot;)</span>
                );
<span class="nc" id="L404">    }</span>

    @Test
    @CmmnDeployment(resources = &quot;org/flowable/cmmn/test/runtime/HumanTaskTest.testHumanTaskIdVariableName.cmmn&quot;)
    public void testHumanTaskIdVariableName() {
<span class="nc" id="L409">        Authentication.setAuthenticatedUserId(&quot;JohnDoe&quot;);</span>

<span class="nc" id="L411">        CaseInstance caseInstance = cmmnRuntimeService.createCaseInstanceBuilder()</span>
<span class="nc" id="L412">                .caseDefinitionKey(&quot;myCase&quot;)</span>
<span class="nc" id="L413">                .start();</span>

        // Normal string
<span class="nc" id="L416">        Task firstTask = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).taskDefinitionKey(&quot;task1&quot;).singleResult();</span>
<span class="nc" id="L417">        assertThat(firstTask).isNotNull();</span>

<span class="nc" id="L419">        String actualTaskId = firstTask.getId();</span>
<span class="nc" id="L420">        String myTaskId = (String)cmmnRuntimeService.getVariable(caseInstance.getId(), &quot;myTaskId&quot;);</span>
<span class="nc" id="L421">        assertThat(myTaskId).isEqualTo(actualTaskId);</span>

        // Expression
<span class="nc" id="L424">        Task secondTask = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).taskDefinitionKey(&quot;task2&quot;).singleResult();</span>
<span class="nc" id="L425">        assertThat(secondTask).isNotNull();</span>

<span class="nc" id="L427">        actualTaskId = secondTask.getId();</span>
<span class="nc" id="L428">        String myExpressionTaskId = (String)cmmnRuntimeService.getVariable(caseInstance.getId(), &quot;myExpressionTaskId&quot;);</span>
<span class="nc" id="L429">        assertThat(myExpressionTaskId).isEqualTo(actualTaskId);</span>
<span class="nc" id="L430">    }</span>

    @Test
    @CmmnDeployment(resources = &quot;org/flowable/cmmn/test/runtime/HumanTaskTest.testHumanTaskCompleterVariableName.cmmn&quot;)
    public void testHumanTaskCompleterVariableName() {
<span class="nc" id="L435">        Authentication.setAuthenticatedUserId(&quot;JohnDoe&quot;);</span>

<span class="nc" id="L437">        CaseInstance caseInstance = cmmnRuntimeService.createCaseInstanceBuilder()</span>
<span class="nc" id="L438">                .caseDefinitionKey(&quot;myCase&quot;)</span>
<span class="nc" id="L439">                .variable(&quot;dynamicVariable&quot;, &quot;myDynamicVariable&quot;)</span>
<span class="nc" id="L440">                .start();</span>

        // Normal string
<span class="nc" id="L443">        Task firstTask = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).taskDefinitionKey(&quot;task1&quot;).singleResult();</span>
<span class="nc" id="L444">        assertThat(firstTask).isNotNull();</span>
<span class="nc" id="L445">        cmmnTaskService.complete(firstTask.getId());</span>
<span class="nc" id="L446">        String completerTask1 = (String)cmmnRuntimeService.getVariable(caseInstance.getId(), &quot;completerTask1&quot;);</span>
<span class="nc" id="L447">        assertThat(completerTask1).isEqualTo(&quot;JohnDoe&quot;);</span>

        // No authenticated user
<span class="nc" id="L450">        Authentication.setAuthenticatedUserId(null);</span>
<span class="nc" id="L451">        Task secondTask = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).taskDefinitionKey(&quot;task2&quot;).singleResult();</span>
<span class="nc" id="L452">        assertThat(secondTask).isNotNull();</span>
<span class="nc" id="L453">        cmmnTaskService.complete(secondTask.getId());</span>
<span class="nc" id="L454">        String completerTask2 = (String)cmmnRuntimeService.getVariable(caseInstance.getId(), &quot;completerTask2&quot;);</span>
<span class="nc" id="L455">        assertThat(completerTask2).isNull();</span>

        // Expression
<span class="nc" id="L458">        Authentication.setAuthenticatedUserId(&quot;DynamicDoe&quot;);</span>
<span class="nc" id="L459">        Task thirdTask = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).taskDefinitionKey(&quot;task3&quot;).singleResult();</span>
<span class="nc" id="L460">        assertThat(thirdTask).isNotNull();</span>
<span class="nc" id="L461">        cmmnTaskService.complete(thirdTask.getId());</span>
<span class="nc" id="L462">        String completerTask3 = (String)cmmnRuntimeService.getVariable(caseInstance.getId(), &quot;myDynamicVariable&quot;);</span>
<span class="nc" id="L463">        assertThat(completerTask3).isEqualTo(&quot;DynamicDoe&quot;);</span>
<span class="nc" id="L464">    }</span>

    @Test
    @CmmnDeployment(resources = &quot;org/flowable/cmmn/test/runtime/oneHumanTaskCase.cmmn&quot;)
    public void testFillTaskLifecycleValues() {
<span class="nc" id="L469">        CaseInstance caseInstance = cmmnRuntimeService.createCaseInstanceBuilder()</span>
<span class="nc" id="L470">                        .caseDefinitionKey(&quot;oneHumanTaskCase&quot;)</span>
<span class="nc" id="L471">                        .start();</span>
<span class="nc" id="L472">        assertThat(caseInstance).isNotNull();</span>

<span class="nc" id="L474">        Task task = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).singleResult();</span>
<span class="nc" id="L475">        assertThat(task.getName()).isEqualTo(&quot;Sub task&quot;);</span>
        
<span class="nc bnc" id="L477" title="All 2 branches missed.">        if (CmmnHistoryTestHelper.isHistoryLevelAtLeast(HistoryLevel.AUDIT, cmmnEngineConfiguration)) {</span>
<span class="nc" id="L478">            HistoricTaskInstance historicTaskInstance = cmmnHistoryService.createHistoricTaskInstanceQuery().taskId(task.getId()).singleResult();</span>
<span class="nc" id="L479">            assertThat(historicTaskInstance.getState()).isEqualTo(Task.CREATED);</span>
<span class="nc" id="L480">            assertThat(historicTaskInstance.getCreateTime()).isNotNull();</span>
        }
        
<span class="nc" id="L483">        cmmnTaskService.claim(task.getId(), &quot;kermit&quot;);</span>
<span class="nc" id="L484">        task = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).singleResult();</span>
<span class="nc" id="L485">        assertThat(task.getState()).isEqualTo(Task.CLAIMED);</span>
<span class="nc" id="L486">        assertThat(task.getClaimTime()).isNotNull();</span>
<span class="nc" id="L487">        assertThat(task.getClaimedBy()).isEqualTo(&quot;kermit&quot;);</span>
        
<span class="nc bnc" id="L489" title="All 2 branches missed.">        if (CmmnHistoryTestHelper.isHistoryLevelAtLeast(HistoryLevel.AUDIT, cmmnEngineConfiguration)) {</span>
<span class="nc" id="L490">            HistoricTaskInstance historicTaskInstance = cmmnHistoryService.createHistoricTaskInstanceQuery().taskId(task.getId()).singleResult();</span>
<span class="nc" id="L491">            assertThat(historicTaskInstance.getState()).isEqualTo(Task.CLAIMED);</span>
<span class="nc" id="L492">            assertThat(historicTaskInstance.getClaimTime()).isNotNull();</span>
<span class="nc" id="L493">            assertThat(historicTaskInstance.getClaimedBy()).isEqualTo(&quot;kermit&quot;);</span>
        }
        
<span class="nc" id="L496">        cmmnTaskService.startProgress(task.getId(), &quot;fozzie&quot;);</span>
<span class="nc" id="L497">        task = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).singleResult();</span>
<span class="nc" id="L498">        assertThat(task.getState()).isEqualTo(Task.IN_PROGRESS);</span>
<span class="nc" id="L499">        assertThat(task.getInProgressStartTime()).isNotNull();</span>
<span class="nc" id="L500">        assertThat(task.getInProgressStartedBy()).isEqualTo(&quot;fozzie&quot;);</span>
        
<span class="nc bnc" id="L502" title="All 2 branches missed.">        if (CmmnHistoryTestHelper.isHistoryLevelAtLeast(HistoryLevel.AUDIT, cmmnEngineConfiguration)) {</span>
<span class="nc" id="L503">            HistoricTaskInstance historicTaskInstance = cmmnHistoryService.createHistoricTaskInstanceQuery().taskId(task.getId()).singleResult();</span>
<span class="nc" id="L504">            assertThat(historicTaskInstance.getState()).isEqualTo(Task.IN_PROGRESS);</span>
<span class="nc" id="L505">            assertThat(historicTaskInstance.getInProgressStartTime()).isNotNull();</span>
<span class="nc" id="L506">            assertThat(historicTaskInstance.getInProgressStartedBy()).isEqualTo(&quot;fozzie&quot;);</span>
        }
        
<span class="nc" id="L509">        cmmnTaskService.suspendTask(task.getId(), &quot;gonzo&quot;);</span>
<span class="nc" id="L510">        task = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).singleResult();</span>
<span class="nc" id="L511">        assertThat(task.getState()).isEqualTo(Task.SUSPENDED);</span>
<span class="nc" id="L512">        assertThat(task.getSuspendedTime()).isNotNull();</span>
<span class="nc" id="L513">        assertThat(task.getSuspendedBy()).isEqualTo(&quot;gonzo&quot;);</span>
        
<span class="nc bnc" id="L515" title="All 2 branches missed.">        if (CmmnHistoryTestHelper.isHistoryLevelAtLeast(HistoryLevel.AUDIT, cmmnEngineConfiguration)) {</span>
<span class="nc" id="L516">            HistoricTaskInstance historicTaskInstance = cmmnHistoryService.createHistoricTaskInstanceQuery().taskId(task.getId()).singleResult();</span>
<span class="nc" id="L517">            assertThat(historicTaskInstance.getState()).isEqualTo(Task.SUSPENDED);</span>
<span class="nc" id="L518">            assertThat(historicTaskInstance.getSuspendedTime()).isNotNull();</span>
<span class="nc" id="L519">            assertThat(historicTaskInstance.getSuspendedBy()).isEqualTo(&quot;gonzo&quot;);</span>
        }
        
<span class="nc" id="L522">        cmmnTaskService.activateTask(task.getId(), &quot;kermit&quot;);</span>
<span class="nc" id="L523">        task = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).singleResult();</span>
<span class="nc" id="L524">        assertThat(task.getState()).isEqualTo(Task.IN_PROGRESS);</span>
<span class="nc" id="L525">        assertThat(task.getSuspendedTime()).isNull();</span>
<span class="nc" id="L526">        assertThat(task.getSuspendedBy()).isNull();</span>
        
<span class="nc bnc" id="L528" title="All 2 branches missed.">        if (CmmnHistoryTestHelper.isHistoryLevelAtLeast(HistoryLevel.AUDIT, cmmnEngineConfiguration)) {</span>
<span class="nc" id="L529">            HistoricTaskInstance historicTaskInstance = cmmnHistoryService.createHistoricTaskInstanceQuery().taskId(task.getId()).singleResult();</span>
<span class="nc" id="L530">            assertThat(historicTaskInstance.getState()).isEqualTo(Task.IN_PROGRESS);</span>
<span class="nc" id="L531">            assertThat(historicTaskInstance.getClaimTime()).isNotNull();</span>
<span class="nc" id="L532">            assertThat(historicTaskInstance.getClaimedBy()).isEqualTo(&quot;kermit&quot;);</span>
<span class="nc" id="L533">            assertThat(historicTaskInstance.getInProgressStartTime()).isNotNull();</span>
<span class="nc" id="L534">            assertThat(historicTaskInstance.getInProgressStartedBy()).isEqualTo(&quot;fozzie&quot;);</span>
        }
        
<span class="nc" id="L537">        cmmnTaskService.complete(task.getId(), &quot;kermit&quot;);</span>
<span class="nc" id="L538">        assertCaseInstanceEnded(caseInstance.getId());</span>
        
<span class="nc bnc" id="L540" title="All 2 branches missed.">        if (CmmnHistoryTestHelper.isHistoryLevelAtLeast(HistoryLevel.AUDIT, cmmnEngineConfiguration)) {</span>
<span class="nc" id="L541">            HistoricTaskInstance historicTaskInstance = cmmnHistoryService.createHistoricTaskInstanceQuery().taskId(task.getId()).singleResult();</span>
<span class="nc" id="L542">            assertThat(historicTaskInstance.getState()).isEqualTo(Task.COMPLETED);</span>
<span class="nc" id="L543">            assertThat(historicTaskInstance.getEndTime()).isNotNull();</span>
<span class="nc" id="L544">            assertThat(historicTaskInstance.getCompletedBy()).isEqualTo(&quot;kermit&quot;);</span>
        }
<span class="nc" id="L546">    }</span>
    
    @Test
    @CmmnDeployment(resources = &quot;org/flowable/cmmn/test/runtime/oneHumanTaskCase.cmmn&quot;)
    public void testTaskWithTimerJob() {
<span class="nc" id="L551">        Map&lt;String, JobHandler&gt; existingJobHandlers = cmmnEngineConfiguration.getJobHandlers();</span>
<span class="nc" id="L552">        Map&lt;String, JobHandler&gt; updatedJobHandlers = new HashMap&lt;&gt;(existingJobHandlers);</span>
<span class="nc" id="L553">        TestCmmnTaskTimerJobHandler testTimerJobHandler = new TestCmmnTaskTimerJobHandler();</span>
<span class="nc" id="L554">        updatedJobHandlers.put(testTimerJobHandler.getType(), testTimerJobHandler);</span>
<span class="nc" id="L555">        cmmnEngineConfiguration.setJobHandlers(updatedJobHandlers);</span>
<span class="nc" id="L556">        cmmnEngineConfiguration.getJobServiceConfiguration().setJobHandlers(updatedJobHandlers);</span>
        
        try {
<span class="nc" id="L559">            final CaseInstance caseInstance = cmmnRuntimeService.createCaseInstanceBuilder()</span>
<span class="nc" id="L560">                    .caseDefinitionKey(&quot;oneHumanTaskCase&quot;)</span>
<span class="nc" id="L561">                    .start();</span>
    
<span class="nc" id="L563">            final org.flowable.task.api.Task task = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).singleResult();</span>
<span class="nc" id="L564">            assertThat(task.getName()).isEqualTo(&quot;Sub task&quot;);</span>
<span class="nc" id="L565">            assertThat(task.getPriority()).isEqualTo(50);</span>
            
<span class="nc" id="L567">            cmmnEngineConfiguration.getCommandExecutor().execute(new Command&lt;Void&gt;() {</span>
                
                @Override
                public Void execute(CommandContext commandContext) {
<span class="nc" id="L571">                    TimerJobService timerJobService = cmmnEngineConfiguration.getJobServiceConfiguration().getTimerJobService();</span>
<span class="nc" id="L572">                    TimerJobEntity timerJob = timerJobService.createTimerJob();</span>
<span class="nc" id="L573">                    timerJob.setJobType(JobEntity.JOB_TYPE_TIMER);</span>
<span class="nc" id="L574">                    timerJob.setJobHandlerType(testTimerJobHandler.getType());</span>
<span class="nc" id="L575">                    timerJob.setScopeId(caseInstance.getId());</span>
<span class="nc" id="L576">                    timerJob.setSubScopeId(task.getId());</span>
<span class="nc" id="L577">                    timerJob.setScopeType(ScopeTypes.CMMN);</span>
                    
<span class="nc" id="L579">                    Calendar calendar = cmmnEngineConfiguration.getClock().getCurrentCalendar();</span>
<span class="nc" id="L580">                    calendar.add(Calendar.MINUTE, -60);</span>
<span class="nc" id="L581">                    timerJob.setDuedate(calendar.getTime());</span>
                    
<span class="nc" id="L583">                    timerJobService.scheduleTimerJob(timerJob);</span>
                    
<span class="nc" id="L585">                    return null;</span>
                }
            });
            
<span class="nc" id="L589">            CmmnJobTestHelper.waitForJobExecutorToProcessAllJobs(cmmnEngineConfiguration, 5000, 200, true);</span>
            
<span class="nc" id="L591">            Task updatedTask = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).singleResult();</span>
<span class="nc" id="L592">            assertThat(updatedTask.getPriority()).isEqualTo(100);</span>
            
        } finally {
<span class="nc" id="L595">            cmmnEngineConfiguration.setJobHandlers(existingJobHandlers);</span>
<span class="nc" id="L596">            cmmnEngineConfiguration.getJobServiceConfiguration().setJobHandlers(existingJobHandlers);</span>
        }
<span class="nc" id="L598">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>