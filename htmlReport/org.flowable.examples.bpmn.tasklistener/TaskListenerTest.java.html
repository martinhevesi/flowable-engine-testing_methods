<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TaskListenerTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jacoco.exec</a> &gt; <a href="index.source.html" class="el_package">org.flowable.examples.bpmn.tasklistener</a> &gt; <span class="el_source">TaskListenerTest.java</span></div><h1>TaskListenerTest.java</h1><pre class="source lang-java linenums">/* Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.flowable.examples.bpmn.tasklistener;

import static org.assertj.core.api.Assertions.assertThat;
import static org.assertj.core.api.Assertions.assertThatThrownBy;
import static org.assertj.core.api.Assertions.entry;

import java.util.Arrays;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.flowable.common.engine.api.FlowableIllegalArgumentException;
import org.flowable.common.engine.api.FlowableIllegalStateException;
import org.flowable.common.engine.impl.history.HistoryLevel;
import org.flowable.common.engine.impl.scripting.FlowableScriptEvaluationException;
import org.flowable.engine.history.HistoricProcessInstance;
import org.flowable.engine.impl.test.HistoryTestHelper;
import org.flowable.engine.impl.test.PluggableFlowableTestCase;
import org.flowable.engine.repository.ProcessDefinition;
import org.flowable.engine.runtime.ProcessInstance;
import org.flowable.engine.runtime.ProcessInstanceBuilder;
import org.flowable.engine.test.Deployment;
import org.flowable.task.api.Task;
import org.flowable.task.api.history.HistoricTaskInstance;
import org.flowable.task.service.delegate.TaskListener;
import org.junit.jupiter.api.Test;

/**
 * @author Joram Barrez
 */
<span class="nc" id="L43">public class TaskListenerTest extends PluggableFlowableTestCase {</span>

    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerTest.bpmn20.xml&quot; })
    public void testTaskCreateListener() {
<span class="nc" id="L48">        ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(&quot;taskListenerProcess&quot;);</span>
<span class="nc" id="L49">        org.flowable.task.api.Task task = taskService.createTaskQuery().singleResult();</span>
<span class="nc" id="L50">        assertThat(task.getName()).isEqualTo(&quot;Schedule meeting&quot;);</span>
<span class="nc" id="L51">        assertThat(task.getDescription()).isEqualTo(&quot;TaskCreateListener is listening!&quot;);</span>

        // Manually cleanup the process instance. If we don't do this, the
        // following actions will occur:
        // 1. The cleanup rule will delete the process
        // 2. The process deletion will fire a DELETE event to the TaskAllEventsListener
        // 3. The TaskAllEventsListener will set a variable on the org.flowable.task.service.Task
        // 4. Setting that variable will result in an entry in the ACT_HI_DETAIL table
        // 5. The AbstractActivitiTestCase will fail the test because the DB is not clean
        // By triggering the DELETE event from within the test, we ensure that
        // all of the records are written before the test cleanup begins
<span class="nc" id="L62">        runtimeService.deleteProcessInstance(processInstance.getProcessInstanceId(), &quot;&quot;);</span>
<span class="nc" id="L63">    }</span>

    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerInSubProcessTest.bpmn20.xml&quot; })
    public void testTaskCreateListenerInSubProcess() {
<span class="nc" id="L68">        ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(&quot;taskListenerInSubProcess&quot;);</span>
<span class="nc" id="L69">        org.flowable.task.api.Task task = taskService.createTaskQuery().singleResult();</span>
<span class="nc" id="L70">        assertThat(task.getName()).isEqualTo(&quot;Schedule meeting&quot;);</span>
<span class="nc" id="L71">        assertThat(task.getDescription()).isEqualTo(&quot;TaskCreateListener is listening!&quot;);</span>

<span class="nc" id="L73">        runtimeService.deleteProcessInstance(processInstance.getProcessInstanceId(), &quot;&quot;);</span>
<span class="nc" id="L74">    }</span>

    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerTest.bpmn20.xml&quot; })
    public void testTaskAssignmentListener() {
<span class="nc" id="L79">        ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(&quot;taskListenerProcess&quot;);</span>
<span class="nc" id="L80">        org.flowable.task.api.Task task = taskService.createTaskQuery().singleResult();</span>
<span class="nc" id="L81">        assertThat(task.getDescription()).isEqualTo(&quot;TaskCreateListener is listening!&quot;);</span>

        // Set assignee and check if event is received
<span class="nc" id="L84">        taskService.setAssignee(task.getId(), &quot;kermit&quot;);</span>
<span class="nc" id="L85">        task = taskService.createTaskQuery().singleResult();</span>
<span class="nc" id="L86">        assertThat(task.getDescription()).isEqualTo(&quot;TaskAssignmentListener is listening: kermit&quot;);</span>

<span class="nc" id="L88">        runtimeService.deleteProcessInstance(processInstance.getProcessInstanceId(), &quot;&quot;);</span>
        
<span class="nc" id="L90">        waitForHistoryJobExecutorToProcessAllJobs(7000, 100);</span>
<span class="nc" id="L91">    }</span>

    /**
     * Validate fix for ACT-1627: Not throwing assignment event on every update
     */
    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerTest.bpmn20.xml&quot; })
    public void testTaskAssignmentListenerNotCalledWhenAssigneeNotUpdated() {
<span class="nc" id="L99">        ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(&quot;taskListenerProcess&quot;);</span>
<span class="nc" id="L100">        org.flowable.task.api.Task task = taskService.createTaskQuery().singleResult();</span>
<span class="nc" id="L101">        assertThat(task.getDescription()).isEqualTo(&quot;TaskCreateListener is listening!&quot;);</span>

        // Set assignee and check if event is received
<span class="nc" id="L104">        taskService.setAssignee(task.getId(), &quot;kermit&quot;);</span>
<span class="nc" id="L105">        task = taskService.createTaskQuery().singleResult();</span>

<span class="nc" id="L107">        assertThat(task.getDescription()).isEqualTo(&quot;TaskAssignmentListener is listening: kermit&quot;);</span>

        // Reset description and assign to same person. This should NOT trigger an assignment
<span class="nc" id="L110">        task.setDescription(&quot;Clear&quot;);</span>
<span class="nc" id="L111">        taskService.saveTask(task);</span>
<span class="nc" id="L112">        taskService.setAssignee(task.getId(), &quot;kermit&quot;);</span>
<span class="nc" id="L113">        task = taskService.createTaskQuery().singleResult();</span>
<span class="nc" id="L114">        assertThat(task.getDescription()).isEqualTo(&quot;Clear&quot;);</span>

        // Set assignee through task-update
<span class="nc" id="L117">        task.setAssignee(&quot;kermit&quot;);</span>
<span class="nc" id="L118">        taskService.saveTask(task);</span>

<span class="nc" id="L120">        task = taskService.createTaskQuery().singleResult();</span>
<span class="nc" id="L121">        assertThat(task.getDescription()).isEqualTo(&quot;Clear&quot;);</span>

        // Update another property should not trigger assignment
<span class="nc" id="L124">        task.setName(&quot;test&quot;);</span>
<span class="nc" id="L125">        taskService.saveTask(task);</span>

<span class="nc" id="L127">        task = taskService.createTaskQuery().singleResult();</span>
<span class="nc" id="L128">        assertThat(task.getDescription()).isEqualTo(&quot;Clear&quot;);</span>

        // Update to different
<span class="nc" id="L131">        task.setAssignee(&quot;john&quot;);</span>
<span class="nc" id="L132">        taskService.saveTask(task);</span>

<span class="nc" id="L134">        task = taskService.createTaskQuery().singleResult();</span>
<span class="nc" id="L135">        assertThat(task.getDescription()).isEqualTo(&quot;TaskAssignmentListener is listening: john&quot;);</span>

        // Manually cleanup the process instance.
<span class="nc" id="L138">        runtimeService.deleteProcessInstance(processInstance.getProcessInstanceId(), &quot;&quot;);</span>
        
<span class="nc" id="L140">        waitForHistoryJobExecutorToProcessAllJobs(7000, 100);</span>
<span class="nc" id="L141">    }</span>
    
    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerTest.bpmn20.xml&quot; })
    public void testTaskUnassignListener() {
<span class="nc" id="L146">        ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(&quot;taskListenerProcess&quot;);</span>
<span class="nc" id="L147">        org.flowable.task.api.Task task = taskService.createTaskQuery().singleResult();</span>

        // Set assignee and check if event is received
<span class="nc" id="L150">        taskService.claim(task.getId(), &quot;kermit&quot;);</span>
<span class="nc" id="L151">        task = taskService.createTaskQuery().singleResult();</span>
<span class="nc" id="L152">        assertThat(task.getDescription()).isEqualTo(&quot;TaskAssignmentListener is listening: kermit&quot;);</span>

<span class="nc" id="L154">        taskService.unclaim(task.getId());</span>
<span class="nc" id="L155">        task = taskService.createTaskQuery().singleResult();</span>
<span class="nc" id="L156">        assertThat(task.getDescription()).isEqualTo(&quot;TaskAssignmentListener is listening: null&quot;);</span>

<span class="nc" id="L158">        taskService.setAssignee(task.getId(), &quot;kermit&quot;);</span>
<span class="nc" id="L159">        task = taskService.createTaskQuery().singleResult();</span>
<span class="nc" id="L160">        assertThat(task.getDescription()).isEqualTo(&quot;TaskAssignmentListener is listening: kermit&quot;);</span>

<span class="nc" id="L162">        taskService.setAssignee(task.getId(), null);</span>
<span class="nc" id="L163">        task = taskService.createTaskQuery().singleResult();</span>
<span class="nc" id="L164">        assertThat(task.getDescription()).isEqualTo(&quot;TaskAssignmentListener is listening: null&quot;);</span>

<span class="nc" id="L166">        runtimeService.deleteProcessInstance(processInstance.getProcessInstanceId(), &quot;&quot;);</span>

<span class="nc" id="L168">        waitForHistoryJobExecutorToProcessAllJobs(7000, 100);</span>
<span class="nc" id="L169">    }</span>

    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerTest.bpmn20.xml&quot; })
    public void testTaskCompleteListener() {
<span class="nc" id="L174">        ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(&quot;taskListenerProcess&quot;);</span>
<span class="nc" id="L175">        assertThat(runtimeService.getVariable(processInstance.getId(), &quot;greeting&quot;)).isNull();</span>
<span class="nc" id="L176">        assertThat(runtimeService.getVariable(processInstance.getId(), &quot;expressionValue&quot;)).isNull();</span>

        // Completing first task will change the description
<span class="nc" id="L179">        org.flowable.task.api.Task task = taskService.createTaskQuery().singleResult();</span>
<span class="nc" id="L180">        taskService.complete(task.getId());</span>

<span class="nc" id="L182">        assertThat(runtimeService.getVariable(processInstance.getId(), &quot;greeting&quot;)).isEqualTo(&quot;Hello from The Process&quot;);</span>
<span class="nc" id="L183">        assertThat(runtimeService.getVariable(processInstance.getId(), &quot;shortName&quot;)).isEqualTo(&quot;Act&quot;);</span>
<span class="nc" id="L184">    }</span>

    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerTest.bpmn20.xml&quot; })
    public void testTaskListenerWithExpression() {
<span class="nc" id="L189">        ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(&quot;taskListenerProcess&quot;);</span>
<span class="nc" id="L190">        assertThat(runtimeService.getVariable(processInstance.getId(), &quot;greeting2&quot;)).isNull();</span>

        // Completing first task will change the description
<span class="nc" id="L193">        org.flowable.task.api.Task task = taskService.createTaskQuery().singleResult();</span>
<span class="nc" id="L194">        taskService.complete(task.getId());</span>

<span class="nc" id="L196">        assertThat(runtimeService.getVariable(processInstance.getId(), &quot;greeting2&quot;)).isEqualTo(&quot;Write meeting notes&quot;);</span>
<span class="nc" id="L197">    }</span>

    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerTest.bpmn20.xml&quot; })
    public void testAllEventsTaskListener() {
<span class="nc" id="L202">        runtimeService.startProcessInstanceByKey(&quot;taskListenerProcess&quot;);</span>
<span class="nc" id="L203">        org.flowable.task.api.Task task = taskService.createTaskQuery().singleResult();</span>

        // Set assignee and complete task
<span class="nc" id="L206">        taskService.setAssignee(task.getId(), &quot;kermit&quot;);</span>
<span class="nc" id="L207">        taskService.complete(task.getId());</span>

        // Verify the all-listener has received all events
<span class="nc" id="L210">        String eventsReceived = (String) runtimeService.getVariable(task.getProcessInstanceId(), &quot;events&quot;);</span>
<span class="nc" id="L211">        assertThat(eventsReceived).isEqualTo(&quot;create - assignment - complete - delete&quot;);</span>
<span class="nc" id="L212">        waitForHistoryJobExecutorToProcessAllJobs(7000, 100);</span>
<span class="nc" id="L213">    }</span>

    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerTest.testTaskListenersOnDelete.bpmn20.xml&quot; })
    public void testTaskListenersOnDeleteByComplete() {
<span class="nc" id="L218">        TaskDeleteListener.clear();</span>
<span class="nc" id="L219">        TaskSimpleCompleteListener.clear();</span>
<span class="nc" id="L220">        runtimeService.startProcessInstanceByKey(&quot;executionListenersOnDelete&quot;);</span>

<span class="nc" id="L222">        List&lt;org.flowable.task.api.Task&gt; tasks = taskService.createTaskQuery().list();</span>
<span class="nc" id="L223">        assertThat(tasks).hasSize(1);</span>

<span class="nc" id="L225">        org.flowable.task.api.Task task = taskService.createTaskQuery().taskName(&quot;User Task 1&quot;).singleResult();</span>
<span class="nc" id="L226">        assertThat(task).isNotNull();</span>

<span class="nc" id="L228">        assertThat(TaskDeleteListener.getCurrentMessages()).isEmpty();</span>
<span class="nc" id="L229">        assertThat(TaskSimpleCompleteListener.getCurrentMessages()).isEmpty();</span>

<span class="nc" id="L231">        taskService.complete(task.getId());</span>

<span class="nc" id="L233">        tasks = taskService.createTaskQuery().list();</span>

<span class="nc" id="L235">        assertThat(tasks).isEmpty();</span>

<span class="nc" id="L237">        assertThat(TaskDeleteListener.getCurrentMessages())</span>
<span class="nc" id="L238">                .containsOnly(&quot;Delete Task Listener executed.&quot;);</span>

<span class="nc" id="L240">        assertThat(TaskSimpleCompleteListener.getCurrentMessages())</span>
<span class="nc" id="L241">                .containsOnly(&quot;Complete Task Listener executed.&quot;);</span>
<span class="nc" id="L242">    }</span>

    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerTest.testTaskListenersOnDelete.bpmn20.xml&quot; })
    public void testTaskListenersOnDeleteByDeleteProcessInstance() {
<span class="nc" id="L247">        TaskDeleteListener.clear();</span>
<span class="nc" id="L248">        TaskSimpleCompleteListener.clear();</span>
<span class="nc" id="L249">        ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(&quot;executionListenersOnDelete&quot;);</span>

<span class="nc" id="L251">        List&lt;org.flowable.task.api.Task&gt; tasks = taskService.createTaskQuery().list();</span>
<span class="nc" id="L252">        assertThat(tasks).hasSize(1);</span>

<span class="nc" id="L254">        org.flowable.task.api.Task task = taskService.createTaskQuery().taskName(&quot;User Task 1&quot;).singleResult();</span>
<span class="nc" id="L255">        assertThat(task).isNotNull();</span>

<span class="nc" id="L257">        assertThat(TaskDeleteListener.getCurrentMessages()).isEmpty();</span>
<span class="nc" id="L258">        assertThat(TaskSimpleCompleteListener.getCurrentMessages()).isEmpty();</span>

<span class="nc" id="L260">        runtimeService.deleteProcessInstance(processInstance.getProcessInstanceId(), &quot;&quot;);</span>

<span class="nc" id="L262">        tasks = taskService.createTaskQuery().list();</span>

<span class="nc" id="L264">        assertThat(tasks).isEmpty();</span>

<span class="nc" id="L266">        assertThat(TaskDeleteListener.getCurrentMessages())</span>
<span class="nc" id="L267">                .containsOnly(&quot;Delete Task Listener executed.&quot;);</span>

<span class="nc" id="L269">        assertThat(TaskSimpleCompleteListener.getCurrentMessages()).isEmpty();</span>
<span class="nc" id="L270">    }</span>

    @Test
    @Deployment
    public void testTaskServiceTaskListeners() {
<span class="nc" id="L275">        ProcessInstance processInstance = runtimeService.createProcessInstanceBuilder()</span>
<span class="nc" id="L276">            .processDefinitionKey(&quot;taskServiceListeners&quot;)</span>
<span class="nc" id="L277">            .transientVariable(&quot;taskServiceTaskDelegateTaskListener&quot;,</span>
<span class="nc" id="L278">                (TaskListener) delegateTask -&gt; delegateTask.setVariable(&quot;variableFromDelegateExpression&quot;, &quot;From delegate expression&quot;))</span>
<span class="nc" id="L279">            .start();</span>

<span class="nc" id="L281">        assertThat(processInstance.getProcessVariables())</span>
<span class="nc" id="L282">            .containsOnly(</span>
<span class="nc" id="L283">                entry(&quot;variableFromClassDelegate&quot;, &quot;From class delegate&quot;),</span>
<span class="nc" id="L284">                entry(&quot;variableFromDelegateExpression&quot;, &quot;From delegate expression&quot;)</span>
            );
<span class="nc" id="L286">    }</span>

    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerDelegateExpressionThrowsException.bpmn20.xml&quot; })
    public void testTaskListenerWithDelegateExpressionThrowsFlowableException() {
<span class="nc" id="L291">        ProcessInstanceBuilder builder = runtimeService</span>
<span class="nc" id="L292">                .createProcessInstanceBuilder()</span>
<span class="nc" id="L293">                .processDefinitionKey(&quot;taskListenerProcess&quot;)</span>
<span class="nc" id="L294">                .transientVariable(&quot;bean&quot;, (TaskListener) delegateTask -&gt; {</span>
<span class="nc" id="L295">                    throw new FlowableIllegalArgumentException(&quot;Message from listener&quot;);</span>
                });
<span class="nc" id="L297">        assertThatThrownBy(builder::start)</span>
<span class="nc" id="L298">                .isInstanceOf(FlowableIllegalArgumentException.class)</span>
<span class="nc" id="L299">                .hasNoCause()</span>
<span class="nc" id="L300">                .hasMessage(&quot;Message from listener&quot;);</span>
<span class="nc" id="L301">    }</span>

    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerDelegateExpressionThrowsException.bpmn20.xml&quot; })
    public void testTaskListenerWithDelegateExpressionThrowsNonFlowableException() {
<span class="nc" id="L306">        ProcessInstanceBuilder builder = runtimeService</span>
<span class="nc" id="L307">                .createProcessInstanceBuilder()</span>
<span class="nc" id="L308">                .processDefinitionKey(&quot;taskListenerProcess&quot;)</span>
<span class="nc" id="L309">                .transientVariable(&quot;bean&quot;, (TaskListener) delegateTask -&gt; {</span>
<span class="nc" id="L310">                    throw new RuntimeException(&quot;Message from listener&quot;);</span>
                });
<span class="nc" id="L312">        assertThatThrownBy(builder::start)</span>
<span class="nc" id="L313">                .isExactlyInstanceOf(RuntimeException.class)</span>
<span class="nc" id="L314">                .hasNoCause()</span>
<span class="nc" id="L315">                .hasMessage(&quot;Message from listener&quot;);</span>
<span class="nc" id="L316">    }</span>

    @Test
    @Deployment(resources = &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerNoEventDefined.bpmn20.xml&quot;, validateBpmn = false)
    public void testTaskWithMissingEventAttribute() {
<span class="nc" id="L321">        assertThatThrownBy(() -&gt; runtimeService.startProcessInstanceByKey(&quot;testProcess1&quot;))</span>
<span class="nc" id="L322">                .isInstanceOf(FlowableIllegalStateException.class)</span>
<span class="nc" id="L323">                .hasMessageContaining(&quot;No event defined for taskListener in UserTask 'Task with Listener missing event attribute'&quot;);</span>
<span class="nc" id="L324">    }</span>

    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerTypeScript.bpmn20.xml&quot; })
    public void testInvalidTypeEventListener() {
<span class="nc" id="L329">        assertThatThrownBy(() -&gt; runtimeService.startProcessInstanceByKey(&quot;testProcess3&quot;))</span>
<span class="nc" id="L330">                .isInstanceOf(FlowableIllegalStateException.class)</span>
<span class="nc" id="L331">                .hasMessageContaining(&quot;The field 'script' should be set on ScriptTypeTaskListener&quot;);</span>
<span class="nc" id="L332">    }</span>

    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerTypeScript.bpmn20.xml&quot; })
    public void testTaskListenerTypeScript() {
<span class="nc" id="L337">        Map&lt;String, Object&gt; vars = new HashMap&lt;&gt;();</span>
<span class="nc" id="L338">        vars.put(&quot;scriptLanguageAsExpression&quot;, &quot;groovy&quot;);</span>
<span class="nc" id="L339">        vars.put(&quot;resultVarAsExpression&quot;, &quot;task2ScriptListenerResult&quot;);</span>
<span class="nc" id="L340">        ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(&quot;taskListenerTypeScriptProcess&quot;, vars);</span>
<span class="nc" id="L341">        org.flowable.task.api.Task task = taskService.createTaskQuery().singleResult();</span>
<span class="nc" id="L342">        assertThat(task.getName()).as(&quot;Name does not match&quot;).isEqualTo(&quot;User Task with Script Task Listener&quot;);</span>
<span class="nc" id="L343">        assertThat(task.getOwner()).isEqualTo(&quot;kermit&quot;);</span>

<span class="nc" id="L345">        taskService.complete(task.getId());</span>

<span class="nc bnc" id="L347" title="All 2 branches missed.">        if (HistoryTestHelper.isHistoryLevelAtLeast(HistoryLevel.AUDIT, processEngineConfiguration)) {</span>
            /* The script calls taskService.save(task) after setting the owner.
             * Without calling taskService.save() the historic instance has owner set to null, but the actual instance above
             * has the owner set. */
<span class="nc" id="L351">            HistoricTaskInstance historicTask = historyService.createHistoricTaskInstanceQuery().taskId(task.getId()).singleResult();</span>
<span class="nc" id="L352">            assertThat(historicTask.getOwner()).isEqualTo(&quot;kermit&quot;);</span>

<span class="nc" id="L354">            task = taskService.createTaskQuery().singleResult();</span>
<span class="nc" id="L355">            assertThat(task.getName()).as(&quot;Task name not set with 'scriptResultVariable' variable&quot;).isEqualTo(&quot;User Task 2 name defined in script&quot;);</span>
        }

<span class="nc" id="L358">        Object localVariable = runtimeService.getVariable(processInstance.getId(), &quot;localVariable&quot;);</span>
<span class="nc" id="L359">        assertThat(localVariable).as(&quot;Expected 'localVariable' variable to be local to script&quot;).isNull();</span>

<span class="nc" id="L361">        Object scriptVar = runtimeService.getVariable(processInstance.getId(), &quot;scriptVar&quot;);</span>
<span class="nc" id="L362">        assertThat(scriptVar).as(&quot;Could not find the 'scriptVar' variable in variable scope&quot;).isEqualTo(&quot;scriptVarValue&quot;);</span>

<span class="nc" id="L364">        Object groovyExpressionSyntaxString = runtimeService.getVariable(processInstance.getId(), &quot;groovyExpressionSyntaxString&quot;);</span>
<span class="nc" id="L365">        assertThat(groovyExpressionSyntaxString).as(&quot;Expected groovy expression syntax evaluated&quot;).isEqualTo(&quot;This is a FOO and this is a BAR&quot;);</span>

        // Expect evaluation of script supports expressions for language, payload and resultVariable
<span class="nc" id="L368">        Object task2ScriptListenerResult = runtimeService.getVariable(processInstance.getId(), &quot;task2ScriptListenerResult&quot;);</span>
<span class="nc" id="L369">        assertThat(task2ScriptListenerResult).as(&quot;Expected 'task2ScriptListenerResult' variable in variable scope&quot;).isEqualTo(&quot;usertask2ReturnVal&quot;);</span>
<span class="nc" id="L370">    }</span>

    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerTest.throwBpmnErrorCatchEventSubProcess.bpmn20.xml&quot; })
    public void testTaskListenerThrowBpmnErrorCreate() {
<span class="nc" id="L375">        ProcessInstance processInstance = runtimeService.createProcessInstanceBuilder()</span>
<span class="nc" id="L376">                .processDefinitionKey(&quot;errorHandlingProcess&quot;)</span>
<span class="nc" id="L377">                .variable(&quot;throwErrorCodeTaskListenerCreate&quot;, &quot;MY_ERROR_CODE&quot;)</span>
<span class="nc" id="L378">                .start();</span>

<span class="nc" id="L380">        assertThat(processInstance.getProcessVariables()).containsEntry(&quot;taskListenerCreate&quot;, &quot;executed&quot;).containsEntry(&quot;error_handled_sub_process&quot;, &quot;true&quot;);</span>
<span class="nc" id="L381">    }</span>

    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerTest.throwBpmnErrorCatchEventSubProcess.bpmn20.xml&quot; })
    public void testTaskListenerThrowBpmnErrorAssignment() {
<span class="nc" id="L386">        ProcessInstance processInstance = runtimeService.createProcessInstanceBuilder()</span>
<span class="nc" id="L387">                .processDefinitionKey(&quot;errorHandlingProcess&quot;)</span>
<span class="nc" id="L388">                .variable(&quot;throwErrorCodeTaskListenerAssignment&quot;, &quot;MY_ERROR_CODE&quot;)</span>
<span class="nc" id="L389">                .start();</span>

<span class="nc" id="L391">        org.flowable.task.api.Task task = taskService.createTaskQuery().singleResult();</span>

<span class="nc" id="L393">        taskService.setAssignee(task.getId(), &quot;kermit&quot;);</span>

<span class="nc bnc" id="L395" title="All 2 branches missed.">        if (HistoryTestHelper.isHistoryLevelAtLeast(HistoryLevel.AUDIT, processEngineConfiguration)) {</span>
<span class="nc" id="L396">            HistoricProcessInstance historicProcessInstance = historyService.createHistoricProcessInstanceQuery()</span>
<span class="nc" id="L397">                    .includeProcessVariables()</span>
<span class="nc" id="L398">                    .processInstanceId(processInstance.getId())</span>
<span class="nc" id="L399">                    .singleResult();</span>

<span class="nc" id="L401">            assertThat(historicProcessInstance.getProcessVariables())</span>
<span class="nc" id="L402">                    .containsEntry(&quot;taskListenerCreate&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L403">                    .containsEntry(&quot;taskListenerAssignment&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L404">                    .containsEntry(&quot;error_handled_sub_process&quot;, &quot;true&quot;);</span>
        }
<span class="nc" id="L406">    }</span>

    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerTest.throwBpmnErrorCatchEventSubProcess.bpmn20.xml&quot; })
    public void testTaskListenerThrowBpmnErrorComplete() {
<span class="nc" id="L411">        ProcessInstance processInstance = runtimeService.createProcessInstanceBuilder()</span>
<span class="nc" id="L412">                .processDefinitionKey(&quot;errorHandlingProcess&quot;)</span>
<span class="nc" id="L413">                .variable(&quot;throwErrorCodeTaskListenerComplete&quot;, &quot;MY_ERROR_CODE&quot;)</span>
<span class="nc" id="L414">                .start();</span>

<span class="nc" id="L416">        org.flowable.task.api.Task task = taskService.createTaskQuery().singleResult();</span>

<span class="nc" id="L418">        taskService.complete(task.getId());</span>
<span class="nc bnc" id="L419" title="All 2 branches missed.">        if (HistoryTestHelper.isHistoryLevelAtLeast(HistoryLevel.AUDIT, processEngineConfiguration)) {</span>
<span class="nc" id="L420">            HistoricProcessInstance historicProcessInstance = historyService.createHistoricProcessInstanceQuery()</span>
<span class="nc" id="L421">                    .includeProcessVariables()</span>
<span class="nc" id="L422">                    .processInstanceId(processInstance.getId())</span>
<span class="nc" id="L423">                    .singleResult();</span>

<span class="nc" id="L425">            assertThat(historicProcessInstance.getProcessVariables())</span>
<span class="nc" id="L426">                    .containsEntry(&quot;taskListenerCreate&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L427">                    .containsEntry(&quot;taskListenerComplete&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L428">                    .containsEntry(&quot;error_handled_sub_process&quot;, &quot;true&quot;);</span>
        }
<span class="nc" id="L430">    }</span>

    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerTest.throwBpmnErrorCatchEventSubProcess.bpmn20.xml&quot; })
    public void testTaskListenerThrowBpmnErrorDelete() {
<span class="nc" id="L435">        ProcessInstance processInstance = runtimeService.createProcessInstanceBuilder()</span>
<span class="nc" id="L436">                .processDefinitionKey(&quot;errorHandlingProcess&quot;)</span>
<span class="nc" id="L437">                .variable(&quot;throwErrorCodeTaskListenerDelete&quot;, &quot;MY_ERROR_CODE&quot;)</span>
<span class="nc" id="L438">                .start();</span>

<span class="nc" id="L440">        org.flowable.task.api.Task task = taskService.createTaskQuery().singleResult();</span>

<span class="nc" id="L442">        taskService.complete(task.getId());</span>
<span class="nc bnc" id="L443" title="All 2 branches missed.">        if (HistoryTestHelper.isHistoryLevelAtLeast(HistoryLevel.AUDIT, processEngineConfiguration)) {</span>
<span class="nc" id="L444">            HistoricProcessInstance historicProcessInstance = historyService.createHistoricProcessInstanceQuery()</span>
<span class="nc" id="L445">                    .includeProcessVariables()</span>
<span class="nc" id="L446">                    .processInstanceId(processInstance.getId())</span>
<span class="nc" id="L447">                    .singleResult();</span>

<span class="nc" id="L449">            assertThat(historicProcessInstance.getProcessVariables())</span>
<span class="nc" id="L450">                    .containsEntry(&quot;taskListenerCreate&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L451">                    .containsEntry(&quot;taskListenerDelete&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L452">                    .containsEntry(&quot;error_handled_sub_process&quot;, &quot;true&quot;);</span>
        }
<span class="nc" id="L454">    }</span>

    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerTest.throwBpmnErrorCatchEventSubProcess.bpmn20.xml&quot; })
    public void testTaskListenerThrowBpmnErrorDeleteProcessInstance() {
<span class="nc" id="L459">        ProcessInstance processInstance = runtimeService.createProcessInstanceBuilder()</span>
<span class="nc" id="L460">                .processDefinitionKey(&quot;errorHandlingProcess&quot;)</span>
<span class="nc" id="L461">                .variable(&quot;throwErrorCodeTaskListenerDelete&quot;, &quot;MY_ERROR_CODE&quot;)</span>
<span class="nc" id="L462">                .start();</span>

<span class="nc" id="L464">        runtimeService.deleteProcessInstance(processInstance.getId(), &quot;unit test&quot;);</span>
<span class="nc bnc" id="L465" title="All 2 branches missed.">        if (HistoryTestHelper.isHistoryLevelAtLeast(HistoryLevel.AUDIT, processEngineConfiguration)) {</span>
<span class="nc" id="L466">            HistoricProcessInstance historicProcessInstance = historyService.createHistoricProcessInstanceQuery()</span>
<span class="nc" id="L467">                    .includeProcessVariables()</span>
<span class="nc" id="L468">                    .processInstanceId(processInstance.getId())</span>
<span class="nc" id="L469">                    .singleResult();</span>

<span class="nc" id="L471">            assertThat(historicProcessInstance.getProcessVariables())</span>
<span class="nc" id="L472">                    .containsEntry(&quot;taskListenerCreate&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L473">                    .containsEntry(&quot;taskListenerDelete&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L474">                    .containsEntry(&quot;error_handled_sub_process&quot;, &quot;true&quot;);</span>
        }
<span class="nc" id="L476">    }</span>

    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerTest.throwBpmnErrorCatchEventSubProcessMultiInstance.bpmn20.xml&quot; })
    public void testTaskListenerThrowBpmnErrorCompleteMultiInstance() {
<span class="nc" id="L481">        ProcessInstance processInstance = runtimeService.createProcessInstanceBuilder()</span>
<span class="nc" id="L482">                .processDefinitionKey(&quot;errorHandlingProcess&quot;)</span>
<span class="nc" id="L483">                .variable(&quot;throwErrorCodeTaskListenerComplete&quot;, &quot;MY_ERROR_CODE&quot;)</span>
<span class="nc" id="L484">                .variable(&quot;elements&quot;, Arrays.asList(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;))</span>
<span class="nc" id="L485">                .start();</span>

<span class="nc" id="L487">        assertThat(processInstance.getProcessVariables())</span>
<span class="nc" id="L488">                .containsEntry(&quot;taskListenerCreate_1&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L489">                .containsEntry(&quot;taskListenerCreate_2&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L490">                .containsEntry(&quot;taskListenerCreate_3&quot;, &quot;executed&quot;);</span>

<span class="nc" id="L492">        List&lt;Task&gt; tasks = taskService.createTaskQuery().processInstanceId(processInstance.getId()).list();</span>
<span class="nc" id="L493">        assertThat(tasks).hasSize(3);</span>
<span class="nc bnc" id="L494" title="All 2 branches missed.">        for (Task task : tasks) {</span>
<span class="nc" id="L495">            Task t = taskService.createTaskQuery().taskId(task.getId()).singleResult();</span>
<span class="nc bnc" id="L496" title="All 2 branches missed.">            if (t != null) {</span>
<span class="nc" id="L497">                taskService.complete(t.getId());</span>
            }
<span class="nc" id="L499">        }</span>
<span class="nc bnc" id="L500" title="All 2 branches missed.">        if (HistoryTestHelper.isHistoryLevelAtLeast(HistoryLevel.AUDIT, processEngineConfiguration)) {</span>
<span class="nc" id="L501">            HistoricProcessInstance historicProcessInstance = historyService.createHistoricProcessInstanceQuery()</span>
<span class="nc" id="L502">                    .includeProcessVariables()</span>
<span class="nc" id="L503">                    .processInstanceId(processInstance.getId())</span>
<span class="nc" id="L504">                    .singleResult();</span>

<span class="nc" id="L506">            assertThat(historicProcessInstance.getProcessVariables())</span>
<span class="nc" id="L507">                    .containsEntry(&quot;taskListenerComplete_1&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L508">                    .containsEntry(&quot;taskListenerComplete_2&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L509">                    .containsEntry(&quot;taskListenerCreate_1&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L510">                    .containsEntry(&quot;taskListenerCreate_2&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L511">                    .containsEntry(&quot;taskListenerCreate_3&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L512">                    .containsEntry(&quot;taskListenerDelete_1&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L513">                    .containsEntry(&quot;taskListenerDelete_2&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L514">                    .containsEntry(&quot;taskListenerDelete_3&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L515">                    .containsEntry(&quot;error_handled_sub_process&quot;, &quot;true&quot;);</span>
        }
<span class="nc" id="L517">    }</span>

    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerTest.throwBpmnErrorCatchParentBoundaryEvent.bpmn20.xml&quot; })
    public void testTaskListenerThrowBpmnErrorAssignmentParentBoundaryEvent() {
<span class="nc" id="L522">        ProcessInstance processInstance = runtimeService.createProcessInstanceBuilder()</span>
<span class="nc" id="L523">                .processDefinitionKey(&quot;errorHandlingProcess&quot;)</span>
<span class="nc" id="L524">                .variable(&quot;throwErrorCodeTaskListenerAssignment&quot;, &quot;MY_ERROR_CODE&quot;)</span>
<span class="nc" id="L525">                .start();</span>

<span class="nc" id="L527">        org.flowable.task.api.Task task = taskService.createTaskQuery().singleResult();</span>

<span class="nc" id="L529">        taskService.setAssignee(task.getId(), &quot;kermit&quot;);</span>
<span class="nc bnc" id="L530" title="All 2 branches missed.">        if (HistoryTestHelper.isHistoryLevelAtLeast(HistoryLevel.AUDIT, processEngineConfiguration)) {</span>
<span class="nc" id="L531">            HistoricProcessInstance historicProcessInstance = historyService.createHistoricProcessInstanceQuery()</span>
<span class="nc" id="L532">                    .includeProcessVariables()</span>
<span class="nc" id="L533">                    .processInstanceId(processInstance.getId())</span>
<span class="nc" id="L534">                    .singleResult();</span>

<span class="nc" id="L536">            assertThat(historicProcessInstance.getProcessVariables())</span>
<span class="nc" id="L537">                    .containsEntry(&quot;taskListenerCreate&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L538">                    .containsEntry(&quot;taskListenerAssignment&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L539">                    .containsEntry(&quot;error_handled_boundary_event&quot;, &quot;true&quot;);</span>
        }
<span class="nc" id="L541">    }</span>

    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerTest.throwBpmnErrorCatchParentBoundaryEvent.bpmn20.xml&quot; })
    public void testTaskListenerThrowBpmnErrorCompleteParentBoundaryEvent() {
<span class="nc" id="L546">        ProcessInstance processInstance = runtimeService.createProcessInstanceBuilder()</span>
<span class="nc" id="L547">                .processDefinitionKey(&quot;errorHandlingProcess&quot;)</span>
<span class="nc" id="L548">                .variable(&quot;throwErrorCodeTaskListenerComplete&quot;, &quot;MY_ERROR_CODE&quot;)</span>
<span class="nc" id="L549">                .start();</span>

<span class="nc" id="L551">        org.flowable.task.api.Task task = taskService.createTaskQuery().singleResult();</span>

<span class="nc" id="L553">        taskService.complete(task.getId());</span>
<span class="nc bnc" id="L554" title="All 2 branches missed.">        if (HistoryTestHelper.isHistoryLevelAtLeast(HistoryLevel.AUDIT, processEngineConfiguration)) {</span>
<span class="nc" id="L555">            HistoricProcessInstance historicProcessInstance = historyService.createHistoricProcessInstanceQuery()</span>
<span class="nc" id="L556">                    .includeProcessVariables()</span>
<span class="nc" id="L557">                    .processInstanceId(processInstance.getId())</span>
<span class="nc" id="L558">                    .singleResult();</span>

<span class="nc" id="L560">            assertThat(historicProcessInstance.getProcessVariables())</span>
<span class="nc" id="L561">                    .containsEntry(&quot;taskListenerCreate&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L562">                    .containsEntry(&quot;taskListenerComplete&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L563">                    .containsEntry(&quot;error_handled_boundary_event&quot;, &quot;true&quot;);</span>
        }
<span class="nc" id="L565">    }</span>

    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerTest.throwBpmnErrorCatchParentBoundaryEvent.bpmn20.xml&quot; })
    public void testTaskListenerThrowBpmnErrorDeleteParentBoundaryEvent() {
<span class="nc" id="L570">        ProcessInstance processInstance = runtimeService.createProcessInstanceBuilder()</span>
<span class="nc" id="L571">                .processDefinitionKey(&quot;errorHandlingProcess&quot;)</span>
<span class="nc" id="L572">                .variable(&quot;throwErrorCodeTaskListenerDelete&quot;, &quot;MY_ERROR_CODE&quot;)</span>
<span class="nc" id="L573">                .start();</span>

<span class="nc" id="L575">        org.flowable.task.api.Task task = taskService.createTaskQuery().singleResult();</span>

<span class="nc" id="L577">        taskService.complete(task.getId());</span>
<span class="nc bnc" id="L578" title="All 2 branches missed.">        if (HistoryTestHelper.isHistoryLevelAtLeast(HistoryLevel.AUDIT, processEngineConfiguration)) {</span>
<span class="nc" id="L579">            HistoricProcessInstance historicProcessInstance = historyService.createHistoricProcessInstanceQuery()</span>
<span class="nc" id="L580">                    .includeProcessVariables()</span>
<span class="nc" id="L581">                    .processInstanceId(processInstance.getId())</span>
<span class="nc" id="L582">                    .singleResult();</span>

<span class="nc" id="L584">            assertThat(historicProcessInstance.getProcessVariables())</span>
<span class="nc" id="L585">                    .containsEntry(&quot;taskListenerCreate&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L586">                    .containsEntry(&quot;taskListenerDelete&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L587">                    .containsEntry(&quot;error_handled_boundary_event&quot;, &quot;true&quot;);</span>
        }
<span class="nc" id="L589">    }</span>

    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerTest.throwBpmnErrorCatchParentBoundaryEvent.bpmn20.xml&quot; })
    public void testTaskListenerThrowBpmnErrorDeleteProcessInstanceParentBoundaryEvent() {
<span class="nc" id="L594">        ProcessInstance processInstance = runtimeService.createProcessInstanceBuilder()</span>
<span class="nc" id="L595">                .processDefinitionKey(&quot;errorHandlingProcess&quot;)</span>
<span class="nc" id="L596">                .variable(&quot;throwErrorCodeTaskListenerDelete&quot;, &quot;MY_ERROR_CODE&quot;)</span>
<span class="nc" id="L597">                .start();</span>

<span class="nc" id="L599">        runtimeService.deleteProcessInstance(processInstance.getId(), &quot;unit test&quot;);</span>
<span class="nc bnc" id="L600" title="All 2 branches missed.">        if (HistoryTestHelper.isHistoryLevelAtLeast(HistoryLevel.AUDIT, processEngineConfiguration)) {</span>
<span class="nc" id="L601">            HistoricProcessInstance historicProcessInstance = historyService.createHistoricProcessInstanceQuery()</span>
<span class="nc" id="L602">                    .includeProcessVariables()</span>
<span class="nc" id="L603">                    .processInstanceId(processInstance.getId())</span>
<span class="nc" id="L604">                    .singleResult();</span>

<span class="nc" id="L606">            assertThat(historicProcessInstance.getProcessVariables())</span>
<span class="nc" id="L607">                    .containsEntry(&quot;taskListenerCreate&quot;, &quot;executed&quot;)</span>
<span class="nc" id="L608">                    .containsEntry(&quot;taskListenerDelete&quot;, &quot;executed&quot;)</span>
                    /* Note executed, because the boundary event is attached to the
                       subprocess instance execution which gets deleted. Therefore, the error boundary event on the subprocess
                       is not executed. */
<span class="nc" id="L612">                    .doesNotContainKey(&quot;error_handled_boundary_event&quot;);</span>
        }
<span class="nc" id="L614">    }</span>

    /**
     * Tests error trace enhancement by {@link org.flowable.engine.impl.scripting.ProcessEngineScriptTraceEnhancer} and
     * {@link org.flowable.engine.impl.bpmn.listener.ScriptTypeTaskListener}
     */
    @Test
    @Deployment(resources = { &quot;org/flowable/examples/bpmn/tasklistener/TaskListenerTypeScript.bpmn20.xml&quot; })
    public void testTaskListenerTypeScriptSyntaxErrorInScript() {
<span class="nc" id="L623">        ProcessDefinition processDef = repositoryService.createProcessDefinitionQuery().processDefinitionKey(&quot;testProcessErrorInScript&quot;)</span>
<span class="nc" id="L624">                .singleResult();</span>

<span class="nc" id="L626">        assertThatThrownBy(() -&gt; runtimeService.startProcessInstanceByKey(&quot;testProcessErrorInScript&quot;))</span>
<span class="nc" id="L627">                .isInstanceOf(FlowableScriptEvaluationException.class)</span>
<span class="nc" id="L628">                .hasMessageContaining(</span>
                        &quot;groovy script evaluation failed: 'javax.script.ScriptException: groovy.lang.MissingPropertyException: No such property: syntaxError for class: Script&quot;)
<span class="nc" id="L630">                .hasMessageContaining(&quot;Trace: scopeType=bpmn, scopeDefinitionKey=testProcessErrorInScript, scopeDefinitionId=&quot; + processDef.getId() + &quot;,&quot;</span>
                                + &quot; subScopeDefinitionKey=p4usertask1, tenantId=&lt;empty&gt;, type=taskListener&quot;);
<span class="nc" id="L632">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>