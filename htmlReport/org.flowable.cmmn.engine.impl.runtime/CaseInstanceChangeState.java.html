<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CaseInstanceChangeState.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jacoco.exec</a> &gt; <a href="index.source.html" class="el_package">org.flowable.cmmn.engine.impl.runtime</a> &gt; <span class="el_source">CaseInstanceChangeState.java</span></div><h1>CaseInstanceChangeState.java</h1><pre class="source lang-java linenums">/* Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.flowable.cmmn.engine.impl.runtime;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Set;

import org.flowable.cmmn.api.migration.ActivatePlanItemDefinitionMapping;
import org.flowable.cmmn.api.migration.ChangePlanItemDefinitionWithNewTargetIdsMapping;
import org.flowable.cmmn.api.migration.ChangePlanItemIdMapping;
import org.flowable.cmmn.api.migration.ChangePlanItemIdWithDefinitionIdMapping;
import org.flowable.cmmn.api.migration.MoveToAvailablePlanItemDefinitionMapping;
import org.flowable.cmmn.api.migration.RemoveWaitingForRepetitionPlanItemDefinitionMapping;
import org.flowable.cmmn.api.migration.TerminatePlanItemDefinitionMapping;
import org.flowable.cmmn.api.migration.WaitingForRepetitionPlanItemDefinitionMapping;
import org.flowable.cmmn.api.repository.CaseDefinition;
import org.flowable.cmmn.api.runtime.PlanItemInstanceState;
import org.flowable.cmmn.engine.impl.persistence.entity.PlanItemInstanceEntity;

public class CaseInstanceChangeState {

    protected String caseInstanceId;
    protected CaseDefinition caseDefinitionToMigrateTo;
<span class="nc" id="L37">    protected Map&lt;String, Object&gt; caseVariables = new HashMap&lt;&gt;();</span>
    protected Map&lt;String, List&lt;PlanItemInstanceEntity&gt;&gt; currentPlanItemInstances;
    protected Set&lt;ActivatePlanItemDefinitionMapping&gt; activatePlanItemDefinitions;
    protected Set&lt;MoveToAvailablePlanItemDefinitionMapping&gt; changePlanItemToAvailables;
    protected Set&lt;TerminatePlanItemDefinitionMapping&gt; terminatePlanItemDefinitions;
    protected Set&lt;WaitingForRepetitionPlanItemDefinitionMapping&gt; waitingForRepetitionPlanItemDefinitions;
    protected Set&lt;RemoveWaitingForRepetitionPlanItemDefinitionMapping&gt; removeWaitingForRepetitionPlanItemDefinitions;
    protected Set&lt;ChangePlanItemIdMapping&gt; changePlanItemIds;
    protected Set&lt;ChangePlanItemIdWithDefinitionIdMapping&gt; changePlanItemIdsWithDefinitionId;
    protected Set&lt;ChangePlanItemDefinitionWithNewTargetIdsMapping&gt; changePlanItemDefinitionWithNewTargetIds;
<span class="nc" id="L47">    protected Map&lt;String, Map&lt;String, Object&gt;&gt; childInstanceTaskVariables = new HashMap&lt;&gt;();</span>
<span class="nc" id="L48">    protected Map&lt;String, PlanItemInstanceEntity&gt; createdStageInstances = new HashMap&lt;&gt;();</span>
<span class="nc" id="L49">    protected Map&lt;String, PlanItemInstanceEntity&gt; terminatedPlanItemInstances = new HashMap&lt;&gt;();</span>

<span class="nc" id="L51">    public CaseInstanceChangeState() {</span>
<span class="nc" id="L52">    }</span>

    public String getCaseInstanceId() {
<span class="nc" id="L55">        return caseInstanceId;</span>
    }

    public CaseInstanceChangeState setCaseInstanceId(String caseInstanceId) {
<span class="nc" id="L59">        this.caseInstanceId = caseInstanceId;</span>
<span class="nc" id="L60">        return this;</span>
    }

    public CaseDefinition getCaseDefinitionToMigrateTo() {
<span class="nc" id="L64">        return caseDefinitionToMigrateTo;</span>
    }

    public CaseInstanceChangeState setCaseDefinitionToMigrateTo(CaseDefinition caseDefinitionToMigrateTo) {
<span class="nc" id="L68">        this.caseDefinitionToMigrateTo = caseDefinitionToMigrateTo;</span>
<span class="nc" id="L69">        return this;</span>
    }

    public Map&lt;String, Object&gt; getCaseVariables() {
<span class="nc" id="L73">        return caseVariables;</span>
    }

    public CaseInstanceChangeState setCaseVariables(Map&lt;String, Object&gt; caseVariables) {
<span class="nc" id="L77">        this.caseVariables = caseVariables;</span>
<span class="nc" id="L78">        return this;</span>
    }

    public Map&lt;String, List&lt;PlanItemInstanceEntity&gt;&gt; getCurrentPlanItemInstances() {
<span class="nc" id="L82">        return currentPlanItemInstances;</span>
    }

    public void setCurrentPlanItemInstances(Map&lt;String, List&lt;PlanItemInstanceEntity&gt;&gt; currentPlanItemInstances) {
<span class="nc" id="L86">        this.currentPlanItemInstances = currentPlanItemInstances;</span>
<span class="nc" id="L87">    }</span>
    
    public PlanItemInstanceEntity getRuntimePlanItemInstance(String planItemDefinitionId) {
<span class="nc" id="L90">        PlanItemInstanceEntity foundPlanItemInstance = null;</span>
<span class="nc bnc" id="L91" title="All 4 branches missed.">        if (currentPlanItemInstances != null &amp;&amp; currentPlanItemInstances.containsKey(planItemDefinitionId)) {</span>
<span class="nc" id="L92">            List&lt;PlanItemInstanceEntity&gt; currentPlanItemInstanceList = currentPlanItemInstances.get(planItemDefinitionId);</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">            for (PlanItemInstanceEntity planItemInstance : currentPlanItemInstanceList) {</span>
<span class="nc bnc" id="L94" title="All 4 branches missed.">                if (!PlanItemInstanceState.TERMINAL_STATES.contains(planItemInstance.getState()) &amp;&amp; </span>
<span class="nc bnc" id="L95" title="All 2 branches missed.">                        (foundPlanItemInstance == null || !PlanItemInstanceState.WAITING_FOR_REPETITION.equals(planItemInstance.getState()))) {</span>
                    
<span class="nc" id="L97">                    foundPlanItemInstance = planItemInstance;</span>
                }
<span class="nc" id="L99">            }</span>
        }
        
<span class="nc" id="L102">        return foundPlanItemInstance;</span>
    }
    
    public Map&lt;String, List&lt;PlanItemInstanceEntity&gt;&gt; getActivePlanItemInstances() {
<span class="nc" id="L106">        Map&lt;String, List&lt;PlanItemInstanceEntity&gt;&gt; activePlanItemInstanceMap = new HashMap&lt;&gt;();</span>
<span class="nc bnc" id="L107" title="All 2 branches missed.">        if (currentPlanItemInstances != null) {</span>
<span class="nc bnc" id="L108" title="All 2 branches missed.">            for (String planItemDefinitionId : currentPlanItemInstances.keySet()) {</span>
<span class="nc" id="L109">                List&lt;PlanItemInstanceEntity&gt; planItemInstances = currentPlanItemInstances.get(planItemDefinitionId);</span>
<span class="nc" id="L110">                List&lt;PlanItemInstanceEntity&gt; activePlanItemInstances = null;</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">                for (PlanItemInstanceEntity planItemInstance : planItemInstances) {</span>
<span class="nc bnc" id="L112" title="All 2 branches missed.">                    if (PlanItemInstanceState.ACTIVE_STATES.contains(planItemInstance.getState())) {</span>
<span class="nc bnc" id="L113" title="All 2 branches missed.">                        if (activePlanItemInstances == null) {</span>
<span class="nc" id="L114">                            activePlanItemInstances = new ArrayList&lt;&gt;();</span>
                        }
                        
<span class="nc" id="L117">                        activePlanItemInstances.add(planItemInstance);</span>
                    }
<span class="nc" id="L119">                }</span>
                
<span class="nc bnc" id="L121" title="All 2 branches missed.">                if (activePlanItemInstances != null) {</span>
<span class="nc" id="L122">                    activePlanItemInstanceMap.put(planItemDefinitionId, activePlanItemInstances);</span>
                }
<span class="nc" id="L124">            }</span>
        }
        
<span class="nc" id="L127">        return activePlanItemInstanceMap;</span>
    }
    
    public Map&lt;String, List&lt;PlanItemInstanceEntity&gt;&gt; getRuntimePlanItemInstances() {
<span class="nc" id="L131">        Map&lt;String, List&lt;PlanItemInstanceEntity&gt;&gt; runtimePlanItemInstanceMap = new HashMap&lt;&gt;();</span>
<span class="nc bnc" id="L132" title="All 2 branches missed.">        if (currentPlanItemInstances != null) {</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">            for (String planItemDefinitionId : currentPlanItemInstances.keySet()) {</span>
<span class="nc" id="L134">                List&lt;PlanItemInstanceEntity&gt; planItemInstances = currentPlanItemInstances.get(planItemDefinitionId);</span>
<span class="nc" id="L135">                List&lt;PlanItemInstanceEntity&gt; runtimePlanItemInstances = null;</span>
<span class="nc bnc" id="L136" title="All 2 branches missed.">                for (PlanItemInstanceEntity planItemInstance : planItemInstances) {</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">                    if (!PlanItemInstanceState.TERMINAL_STATES.contains(planItemInstance.getState())) {</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">                        if (runtimePlanItemInstances == null) {</span>
<span class="nc" id="L139">                            runtimePlanItemInstances = new ArrayList&lt;&gt;();</span>
                        }
                        
<span class="nc" id="L142">                        runtimePlanItemInstances.add(planItemInstance);</span>
                    }
<span class="nc" id="L144">                }</span>
                
<span class="nc bnc" id="L146" title="All 2 branches missed.">                if (runtimePlanItemInstances != null) {</span>
<span class="nc" id="L147">                    runtimePlanItemInstanceMap.put(planItemDefinitionId, runtimePlanItemInstances);</span>
                }
<span class="nc" id="L149">            }</span>
        }
        
<span class="nc" id="L152">        return runtimePlanItemInstanceMap;</span>
    }

    public Set&lt;ActivatePlanItemDefinitionMapping&gt; getActivatePlanItemDefinitions() {
<span class="nc" id="L156">        return activatePlanItemDefinitions;</span>
    }

    public CaseInstanceChangeState setActivatePlanItemDefinitions(Set&lt;ActivatePlanItemDefinitionMapping&gt; planItemDefinitionMappings) {
<span class="nc" id="L160">        this.activatePlanItemDefinitions = planItemDefinitionMappings;</span>
<span class="nc" id="L161">        return this;</span>
    }
    
    public Set&lt;MoveToAvailablePlanItemDefinitionMapping&gt; getChangePlanItemDefinitionsToAvailable() {
<span class="nc" id="L165">        return changePlanItemToAvailables;</span>
    }

    public CaseInstanceChangeState setChangePlanItemDefinitionsToAvailable(Set&lt;MoveToAvailablePlanItemDefinitionMapping&gt; planItemDefinitionMappings) {
<span class="nc" id="L169">        this.changePlanItemToAvailables = planItemDefinitionMappings;</span>
<span class="nc" id="L170">        return this;</span>
    }

    public Set&lt;TerminatePlanItemDefinitionMapping&gt; getTerminatePlanItemDefinitions() {
<span class="nc" id="L174">        return terminatePlanItemDefinitions;</span>
    }

    public CaseInstanceChangeState setTerminatePlanItemDefinitions(Set&lt;TerminatePlanItemDefinitionMapping&gt; planItemDefinitionMappings) {
<span class="nc" id="L178">        this.terminatePlanItemDefinitions = planItemDefinitionMappings;</span>
<span class="nc" id="L179">        return this;</span>
    }
    
    public Set&lt;WaitingForRepetitionPlanItemDefinitionMapping&gt; getWaitingForRepetitionPlanItemDefinitions() {
<span class="nc" id="L183">        return waitingForRepetitionPlanItemDefinitions;</span>
    }

    public CaseInstanceChangeState setWaitingForRepetitionPlanItemDefinitions(Set&lt;WaitingForRepetitionPlanItemDefinitionMapping&gt; waitingForRepetitionPlanItemDefinitions) {
<span class="nc" id="L187">        this.waitingForRepetitionPlanItemDefinitions = waitingForRepetitionPlanItemDefinitions;</span>
<span class="nc" id="L188">        return this;</span>
    }
    
    public Set&lt;RemoveWaitingForRepetitionPlanItemDefinitionMapping&gt; getRemoveWaitingForRepetitionPlanItemDefinitions() {
<span class="nc" id="L192">        return removeWaitingForRepetitionPlanItemDefinitions;</span>
    }

    public CaseInstanceChangeState setRemoveWaitingForRepetitionPlanItemDefinitions(Set&lt;RemoveWaitingForRepetitionPlanItemDefinitionMapping&gt; removeWaitingForRepetitionPlanItemDefinitions) {
<span class="nc" id="L196">        this.removeWaitingForRepetitionPlanItemDefinitions = removeWaitingForRepetitionPlanItemDefinitions;</span>
<span class="nc" id="L197">        return this;</span>
    }

    public Set&lt;ChangePlanItemIdMapping&gt; getChangePlanItemIds() {
<span class="nc" id="L201">        return changePlanItemIds;</span>
    }

    public CaseInstanceChangeState setChangePlanItemIds(Set&lt;ChangePlanItemIdMapping&gt; changePlanItemIds) {
<span class="nc" id="L205">        this.changePlanItemIds = changePlanItemIds;</span>
<span class="nc" id="L206">        return this;</span>
    }

    public Set&lt;ChangePlanItemIdWithDefinitionIdMapping&gt; getChangePlanItemIdsWithDefinitionId() {
<span class="nc" id="L210">        return changePlanItemIdsWithDefinitionId;</span>
    }

    public CaseInstanceChangeState setChangePlanItemIdsWithDefinitionId(Set&lt;ChangePlanItemIdWithDefinitionIdMapping&gt; changePlanItemIdsWithDefinitionId) {
<span class="nc" id="L214">        this.changePlanItemIdsWithDefinitionId = changePlanItemIdsWithDefinitionId;</span>
<span class="nc" id="L215">        return this;</span>
    }

    public Set&lt;ChangePlanItemDefinitionWithNewTargetIdsMapping&gt; getChangePlanItemDefinitionWithNewTargetIds() {
<span class="nc" id="L219">        return changePlanItemDefinitionWithNewTargetIds;</span>
    }

    public CaseInstanceChangeState setChangePlanItemDefinitionWithNewTargetIds(Set&lt;ChangePlanItemDefinitionWithNewTargetIdsMapping&gt; changePlanItemDefinitionWithNewTargetIds) {
<span class="nc" id="L223">        this.changePlanItemDefinitionWithNewTargetIds = changePlanItemDefinitionWithNewTargetIds;</span>
<span class="nc" id="L224">        return this;</span>
    }

    public Map&lt;String, Map&lt;String, Object&gt;&gt; getChildInstanceTaskVariables() {
<span class="nc" id="L228">        return childInstanceTaskVariables;</span>
    }

    public CaseInstanceChangeState setChildInstanceTaskVariables(Map&lt;String, Map&lt;String, Object&gt;&gt; childInstanceTaskVariables) {
<span class="nc" id="L232">        this.childInstanceTaskVariables = childInstanceTaskVariables;</span>
<span class="nc" id="L233">        return this;</span>
    }

    public Map&lt;String, PlanItemInstanceEntity&gt; getCreatedStageInstances() {
<span class="nc" id="L237">        return createdStageInstances;</span>
    }

    public CaseInstanceChangeState setCreatedStageInstances(HashMap&lt;String, PlanItemInstanceEntity&gt; createdStageInstances) {
<span class="nc" id="L241">        this.createdStageInstances = createdStageInstances;</span>
<span class="nc" id="L242">        return this;</span>
    }
    
    public void addCreatedStageInstance(String key, PlanItemInstanceEntity planItemInstance) {
<span class="nc" id="L246">        this.createdStageInstances.put(key, planItemInstance);</span>
<span class="nc" id="L247">    }</span>
    
    public Map&lt;String, PlanItemInstanceEntity&gt; getTerminatedPlanItemInstances() {
<span class="nc" id="L250">        return terminatedPlanItemInstances;</span>
    }

    public CaseInstanceChangeState setTerminatedPlanItemInstances(HashMap&lt;String, PlanItemInstanceEntity&gt; terminatedPlanItemInstances) {
<span class="nc" id="L254">        this.terminatedPlanItemInstances = terminatedPlanItemInstances;</span>
<span class="nc" id="L255">        return this;</span>
    }
    
    public void addTerminatedPlanItemInstance(String key, PlanItemInstanceEntity planItemInstance) {
<span class="nc" id="L259">        this.terminatedPlanItemInstances.put(key, planItemInstance);</span>
<span class="nc" id="L260">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>