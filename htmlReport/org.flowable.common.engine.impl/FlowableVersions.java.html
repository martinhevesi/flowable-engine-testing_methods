<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FlowableVersions.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jacoco.exec</a> &gt; <a href="index.source.html" class="el_package">org.flowable.common.engine.impl</a> &gt; <span class="el_source">FlowableVersions.java</span></div><h1>FlowableVersions.java</h1><pre class="source lang-java linenums">/* Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *      http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.flowable.common.engine.impl;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

import org.flowable.common.engine.api.FlowableException;

/**
 * @author Joram Barrez
 */
<span class="nc" id="L24">public class FlowableVersions {</span>
    
    public static final String CURRENT_VERSION = &quot;7.0.1.1&quot;; // Note the extra .x at the end. To cater for snapshot releases with different database changes
    
<span class="nc" id="L28">    public static final List&lt;FlowableVersion&gt; FLOWABLE_VERSIONS = new ArrayList&lt;&gt;();</span>
    
<span class="nc" id="L30">    public static final List&lt;FlowableVersion&gt; CAM_MIGRATION_VERSIONS = new ArrayList&lt;&gt;();</span>
    
    public static final String LAST_V5_VERSION = &quot;5.99.0.0&quot;;
    
    public static final String LAST_V6_VERSION_BEFORE_SERVICES = &quot;6.1.2.0&quot;;
    
    static {

        /* Previous */

<span class="nc" id="L40">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.7&quot;));</span>
<span class="nc" id="L41">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.8&quot;));</span>
<span class="nc" id="L42">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.9&quot;));</span>
<span class="nc" id="L43">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.10&quot;));</span>
<span class="nc" id="L44">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.11&quot;));</span>

        // 5.12.1 was a bugfix release on 5.12 and did NOT change the version in ACT_GE_PROPERTY
        // On top of that, DB2 create script for 5.12.1 was shipped with a 'T' suffix ...
<span class="nc" id="L48">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.12&quot;, Arrays.asList(&quot;5.12.1&quot;, &quot;5.12T&quot;)));</span>

<span class="nc" id="L50">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.13&quot;));</span>
<span class="nc" id="L51">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.14&quot;));</span>
<span class="nc" id="L52">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.15&quot;));</span>
<span class="nc" id="L53">        CAM_MIGRATION_VERSIONS.add(new FlowableVersion(&quot;5.15&quot;));</span>
<span class="nc" id="L54">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.15.1&quot;));</span>
<span class="nc" id="L55">        CAM_MIGRATION_VERSIONS.add(new FlowableVersion(&quot;5.15.1&quot;));</span>
<span class="nc" id="L56">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.16&quot;));</span>
<span class="nc" id="L57">        CAM_MIGRATION_VERSIONS.add(new FlowableVersion(&quot;5.16&quot;));</span>
<span class="nc" id="L58">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.16.1&quot;));</span>
<span class="nc" id="L59">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.16.2-SNAPSHOT&quot;));</span>
<span class="nc" id="L60">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.16.2&quot;));</span>
<span class="nc" id="L61">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.16.3.0&quot;));</span>
<span class="nc" id="L62">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.16.4.0&quot;));</span>

<span class="nc" id="L64">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.17.0.0&quot;));</span>
<span class="nc" id="L65">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.17.0.1&quot;));</span>
<span class="nc" id="L66">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.17.0.2&quot;));</span>
<span class="nc" id="L67">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.18.0.0&quot;));</span>
<span class="nc" id="L68">        CAM_MIGRATION_VERSIONS.add(new FlowableVersion(&quot;5.18.0.0&quot;));</span>
<span class="nc" id="L69">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.18.0.1&quot;));</span>
<span class="nc" id="L70">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.20.0.0&quot;));</span>
<span class="nc" id="L71">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.20.0.1&quot;));</span>
<span class="nc" id="L72">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.20.0.2&quot;));</span>
<span class="nc" id="L73">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.21.0.0&quot;));</span>
<span class="nc" id="L74">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.22.0.0&quot;));</span>
<span class="nc" id="L75">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.23.0.0&quot;));</span>
<span class="nc" id="L76">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;5.24.0.0&quot;));</span>

        /*
         * Version 5.18.0.1 is the latest v5 version in the list here, although if you would look at the v5 code, you'll see there are a few other releases afterwards.
         * 
         * The reasoning is as follows: after 5.18.0.1, no database changes were done anymore. And if there would be database changes, they would have been part of both 5.x _and_ 6.x upgrade scripts.
         * The logic below will assume it's one of these releases in case it isn't found in the list here and do the upgrade from the 'virtual' release 5.99.0.0 to make sure th v6 changes are applied.
         */

        // This is the latest version of the 5 branch. It's a 'virtual' version cause it doesn't exist, but it is
        // there to make sure all previous version can upgrade to the 6 version correctly.
<span class="nc" id="L87">        FLOWABLE_VERSIONS.add(new FlowableVersion(LAST_V5_VERSION));</span>

        // Version 6
<span class="nc" id="L90">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.0.0.0&quot;));</span>
<span class="nc" id="L91">        CAM_MIGRATION_VERSIONS.add(new FlowableVersion(&quot;6.0.0.0&quot;));</span>
<span class="nc" id="L92">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.0.0.1&quot;));</span>
<span class="nc" id="L93">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.0.0.2&quot;));</span>
<span class="nc" id="L94">        CAM_MIGRATION_VERSIONS.add(new FlowableVersion(&quot;6.0.0.2&quot;));</span>
<span class="nc" id="L95">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.0.0.3&quot;));</span>
<span class="nc" id="L96">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.0.0.4&quot;));</span>
<span class="nc" id="L97">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.0.0.5&quot;));</span>
<span class="nc" id="L98">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.0.1.0&quot;));</span>
<span class="nc" id="L99">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.1.0.0&quot;));</span>
<span class="nc" id="L100">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.1.1.0&quot;));</span>
<span class="nc" id="L101">        CAM_MIGRATION_VERSIONS.add(new FlowableVersion(&quot;6.1.1.0&quot;));</span>
<span class="nc" id="L102">        FLOWABLE_VERSIONS.add(new FlowableVersion(LAST_V6_VERSION_BEFORE_SERVICES));</span>
<span class="nc" id="L103">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.2.0.0&quot;));</span>
<span class="nc" id="L104">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.2.1.0&quot;));</span>
<span class="nc" id="L105">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.3.0.0&quot;));</span>
<span class="nc" id="L106">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.3.0.1&quot;));</span>
<span class="nc" id="L107">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.3.1.0&quot;));</span>
<span class="nc" id="L108">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.3.2.0&quot;));</span>
<span class="nc" id="L109">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.4.0.0&quot;));</span>
<span class="nc" id="L110">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.4.1.0&quot;));</span>
<span class="nc" id="L111">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.4.1.1&quot;));</span>
<span class="nc" id="L112">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.4.1.2&quot;));</span>
<span class="nc" id="L113">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.4.1.3&quot;));</span>
<span class="nc" id="L114">        CAM_MIGRATION_VERSIONS.add(new FlowableVersion(&quot;6.4.1.3&quot;));</span>
<span class="nc" id="L115">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.5.0.0&quot;));</span>
<span class="nc" id="L116">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.5.0.1&quot;));</span>
<span class="nc" id="L117">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.5.0.2&quot;));</span>
<span class="nc" id="L118">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.5.0.3&quot;));</span>
<span class="nc" id="L119">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.5.0.4&quot;));</span>
<span class="nc" id="L120">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.5.0.5&quot;));</span>
<span class="nc" id="L121">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.5.0.6&quot;));</span>
<span class="nc" id="L122">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.5.1.0&quot;));</span>
<span class="nc" id="L123">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.5.1.1&quot;));</span>
<span class="nc" id="L124">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.5.1.2&quot;));</span>
<span class="nc" id="L125">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.5.1.3&quot;));</span>
<span class="nc" id="L126">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.5.1.4&quot;));</span>
<span class="nc" id="L127">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.5.1.5&quot;));</span>
<span class="nc" id="L128">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.5.1.6&quot;));</span>
<span class="nc" id="L129">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.6.0.0&quot;));</span>
<span class="nc" id="L130">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.6.0.1&quot;));</span>
<span class="nc" id="L131">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.6.1.0&quot;));</span>
<span class="nc" id="L132">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.6.2.0&quot;));</span>
<span class="nc" id="L133">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.6.2.1&quot;));</span>
<span class="nc" id="L134">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.7.0.0&quot;));</span>
<span class="nc" id="L135">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.7.0.1&quot;));</span>
<span class="nc" id="L136">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.7.1.0&quot;));</span>
<span class="nc" id="L137">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.7.2.0&quot;));</span>
<span class="nc" id="L138">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.7.2.1&quot;));</span>
<span class="nc" id="L139">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.7.2.2&quot;));</span>
<span class="nc" id="L140">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.7.2.3&quot;));</span>
<span class="nc" id="L141">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.8.0.0&quot;));</span>
<span class="nc" id="L142">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;6.8.1.0&quot;));</span>
<span class="nc" id="L143">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;7.0.0.0&quot;));</span>
<span class="nc" id="L144">        FLOWABLE_VERSIONS.add(new FlowableVersion(&quot;7.0.1.0&quot;));</span>

        /* Current */
<span class="nc" id="L147">        FLOWABLE_VERSIONS.add(new FlowableVersion(CURRENT_VERSION));</span>
<span class="nc" id="L148">    }</span>
    
    /**
     * Returns the index in the list of {@link #FLOWABLE_VERSIONS} matching the provided string version. Returns -1 if no match can be found.
     */
    public static int findMatchingVersionIndex(FlowableVersion flowableVersion) {
<span class="nc" id="L154">        return findMatchingVersionIndex(flowableVersion.mainVersion);</span>
    }
    
    public static int findMatchingVersionIndex(String dbVersion) {
<span class="nc" id="L158">        int index = 0;</span>
<span class="nc" id="L159">        int matchingVersionIndex = -1;</span>
<span class="nc bnc" id="L160" title="All 4 branches missed.">        while (matchingVersionIndex &lt; 0 &amp;&amp; index &lt; FlowableVersions.FLOWABLE_VERSIONS.size()) {</span>
<span class="nc bnc" id="L161" title="All 2 branches missed.">            if (FlowableVersions.FLOWABLE_VERSIONS.get(index).matches(dbVersion)) {</span>
<span class="nc" id="L162">                matchingVersionIndex = index;</span>
            } else {
<span class="nc" id="L164">                index++;</span>
            }
        }
<span class="nc" id="L167">        return matchingVersionIndex;</span>
    }
    
    public static FlowableVersion getPreviousVersion(String version) {
<span class="nc" id="L171">        int currentVersion = findMatchingVersionIndex(version);</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">        if (currentVersion &gt; 0) {</span>
<span class="nc" id="L173">            return FLOWABLE_VERSIONS.get(currentVersion - 1);</span>
        }
<span class="nc" id="L175">        return null;</span>
    }
    
    public static int getFlowableVersionIndexForDbVersion(String dbVersion) {
        int matchingVersionIndex;
        
<span class="nc bnc" id="L181" title="All 2 branches missed.">        if (&quot;fox&quot;.equalsIgnoreCase(dbVersion)) {</span>
<span class="nc" id="L182">            dbVersion = &quot;5.13&quot;;</span>
        }
        
        // Determine index in the sequence of Flowable releases
<span class="nc" id="L186">        matchingVersionIndex = findMatchingVersionIndex(dbVersion);</span>

        // If no match has been found, but the version starts with '5.x',
        // we assume it's the last version (see comment in the VERSIONS list)
<span class="nc bnc" id="L190" title="All 6 branches missed.">        if (matchingVersionIndex &lt; 0 &amp;&amp; dbVersion != null &amp;&amp; dbVersion.startsWith(&quot;5.&quot;)) {</span>
<span class="nc" id="L191">            matchingVersionIndex = findMatchingVersionIndex(FlowableVersions.LAST_V5_VERSION);</span>
        }

        // Exception when no match was found: unknown/unsupported version
<span class="nc bnc" id="L195" title="All 2 branches missed.">        if (matchingVersionIndex &lt; 0) {</span>
<span class="nc" id="L196">            throw new FlowableException(&quot;Could not update Flowable database schema: unknown version from database: '&quot; + dbVersion + &quot;'&quot;);</span>
        }
        
<span class="nc" id="L199">        return matchingVersionIndex;</span>
    }

    public static boolean hasCamMigrationVersion(String version) {
<span class="nc" id="L203">        int index = findMatchingCamMigrationIndex(version);</span>
<span class="nc bnc" id="L204" title="All 2 branches missed.">        if (index &gt;= 0) {</span>
<span class="nc" id="L205">            return true;</span>
        } else {
<span class="nc" id="L207">            return false;</span>
        }
    }
    
    protected static int findMatchingCamMigrationIndex(String dbVersion) {
<span class="nc" id="L212">        int index = 0;</span>
<span class="nc" id="L213">        int matchingVersionIndex = -1;</span>
<span class="nc bnc" id="L214" title="All 4 branches missed.">        while (matchingVersionIndex &lt; 0 &amp;&amp; index &lt; FlowableVersions.CAM_MIGRATION_VERSIONS.size()) {</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">            if (FlowableVersions.CAM_MIGRATION_VERSIONS.get(index).matches(dbVersion)) {</span>
<span class="nc" id="L216">                matchingVersionIndex = index;</span>
            } else {
<span class="nc" id="L218">                index++;</span>
            }
        }
<span class="nc" id="L221">        return matchingVersionIndex;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>