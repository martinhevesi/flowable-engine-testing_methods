<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>InternalVariableInstanceQueryImpl.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jacoco.exec</a> &gt; <a href="index.source.html" class="el_package">org.flowable.variable.service.impl</a> &gt; <span class="el_source">InternalVariableInstanceQueryImpl.java</span></div><h1>InternalVariableInstanceQueryImpl.java</h1><pre class="source lang-java linenums">/* Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.flowable.variable.service.impl;

import java.util.Collection;
import java.util.List;

import org.apache.commons.lang3.StringUtils;
import org.flowable.common.engine.api.FlowableIllegalArgumentException;
import org.flowable.common.engine.impl.db.SingleCachedEntityMatcher;
import org.flowable.common.engine.impl.persistence.cache.CachedEntity;
import org.flowable.common.engine.impl.persistence.cache.CachedEntityMatcher;
import org.flowable.variable.service.InternalVariableInstanceQuery;
import org.flowable.variable.service.impl.persistence.entity.VariableInstanceEntity;
import org.flowable.variable.service.impl.persistence.entity.data.VariableInstanceDataManager;

/**
 * @author Filip Hrisafov
 */
public class InternalVariableInstanceQueryImpl
        implements InternalVariableInstanceQuery, CachedEntityMatcher&lt;VariableInstanceEntity&gt;, SingleCachedEntityMatcher&lt;VariableInstanceEntity&gt; {

    protected final VariableInstanceDataManager dataManager;

<span class="nc" id="L35">    public InternalVariableInstanceQueryImpl(VariableInstanceDataManager dataManager) {</span>
<span class="nc" id="L36">        this.dataManager = dataManager;</span>
<span class="nc" id="L37">    }</span>

    protected String id;
    protected String taskId;
    protected Collection&lt;String&gt; taskIds;
    protected String processInstanceId;
    protected String executionId;
    protected Collection&lt;String&gt; executionIds;
    protected boolean withoutTaskId;
    protected String scopeId;
    protected Collection&lt;String&gt; scopeIds;
    protected String subScopeId;
    protected Collection&lt;String&gt; subScopeIds;
    protected boolean withoutSubScopeId;
    protected String scopeType;
    protected Collection&lt;String&gt; scopeTypes;
    protected String name;
    protected Collection&lt;String&gt; names;

    @Override
    public InternalVariableInstanceQuery id(String id) {
<span class="nc bnc" id="L58" title="All 2 branches missed.">        if (StringUtils.isEmpty(id)) {</span>
<span class="nc" id="L59">            throw new FlowableIllegalArgumentException(&quot;id is empty&quot;);</span>
        }
<span class="nc" id="L61">        this.id = id;</span>
<span class="nc" id="L62">        return this;</span>
    }

    @Override
    public InternalVariableInstanceQuery taskId(String taskId) {
<span class="nc bnc" id="L67" title="All 2 branches missed.">        if (StringUtils.isEmpty(taskId)) {</span>
<span class="nc" id="L68">            throw new FlowableIllegalArgumentException(&quot;taskId is empty&quot;);</span>
        }

<span class="nc bnc" id="L71" title="All 2 branches missed.">        if (withoutTaskId) {</span>
<span class="nc" id="L72">            throw new FlowableIllegalArgumentException(&quot;Cannot combine taskId(String) with withoutTaskId() in the same query&quot;);</span>
        }

<span class="nc" id="L75">        this.taskId = taskId;</span>
<span class="nc" id="L76">        return this;</span>
    }

    @Override
    public InternalVariableInstanceQuery taskIds(Collection&lt;String&gt; taskIds) {
<span class="nc bnc" id="L81" title="All 4 branches missed.">        if (taskIds == null || taskIds.isEmpty()) {</span>
<span class="nc" id="L82">            throw new FlowableIllegalArgumentException(&quot;taskIds is null or empty&quot;);</span>
        }

<span class="nc bnc" id="L85" title="All 2 branches missed.">        if (withoutTaskId) {</span>
<span class="nc" id="L86">            throw new FlowableIllegalArgumentException(&quot;Cannot combine taskIds(Collection) with withoutTaskId() in the same query&quot;);</span>
        }
<span class="nc" id="L88">        this.taskIds = taskIds;</span>
<span class="nc" id="L89">        return this;</span>
    }

    @Override
    public InternalVariableInstanceQuery processInstanceId(String processInstanceId) {
<span class="nc bnc" id="L94" title="All 2 branches missed.">        if (StringUtils.isEmpty(processInstanceId)) {</span>
<span class="nc" id="L95">            throw new FlowableIllegalArgumentException(&quot;processInstanceId is empty&quot;);</span>
        }
<span class="nc" id="L97">        this.processInstanceId = processInstanceId;</span>
<span class="nc" id="L98">        return this;</span>
    }

    @Override
    public InternalVariableInstanceQuery executionId(String executionId) {
<span class="nc bnc" id="L103" title="All 2 branches missed.">        if (StringUtils.isEmpty(executionId)) {</span>
<span class="nc" id="L104">            throw new FlowableIllegalArgumentException(&quot;executionId is empty&quot;);</span>
        }
<span class="nc" id="L106">        this.executionId = executionId;</span>
<span class="nc" id="L107">        return this;</span>
    }

    @Override
    public InternalVariableInstanceQuery executionIds(Collection&lt;String&gt; executionIds) {
<span class="nc bnc" id="L112" title="All 4 branches missed.">        if (executionIds == null || executionIds.isEmpty()) {</span>
<span class="nc" id="L113">            throw new FlowableIllegalArgumentException(&quot;executionIds is null or empty&quot;);</span>
        }
<span class="nc" id="L115">        this.executionIds = executionIds;</span>
<span class="nc" id="L116">        return this;</span>
    }

    @Override
    public InternalVariableInstanceQuery withoutTaskId() {
<span class="nc bnc" id="L121" title="All 4 branches missed.">        if (taskId != null || taskIds != null) {</span>
<span class="nc" id="L122">            throw new FlowableIllegalArgumentException(&quot;Cannot combine withoutTaskId() with task(String) or taskIds(Collection) in the same query&quot;);</span>
        }
<span class="nc" id="L124">        this.withoutTaskId = true;</span>
<span class="nc" id="L125">        return this;</span>
    }

    @Override
    public InternalVariableInstanceQuery scopeId(String scopeId) {
<span class="nc bnc" id="L130" title="All 2 branches missed.">        if (StringUtils.isEmpty(scopeId)) {</span>
<span class="nc" id="L131">            throw new FlowableIllegalArgumentException(&quot;scopeId is empty&quot;);</span>
        }
<span class="nc" id="L133">        this.scopeId = scopeId;</span>
<span class="nc" id="L134">        return this;</span>
    }

    @Override
    public InternalVariableInstanceQuery scopeIds(Collection&lt;String&gt; scopeIds) {
<span class="nc" id="L139">        this.scopeIds = scopeIds;</span>
<span class="nc" id="L140">        return this;</span>
    }

    @Override
    public InternalVariableInstanceQuery subScopeId(String subScopeId) {
<span class="nc bnc" id="L145" title="All 2 branches missed.">        if (StringUtils.isEmpty(subScopeId)) {</span>
<span class="nc" id="L146">            throw new FlowableIllegalArgumentException(&quot;subScopeId is empty&quot;);</span>
        }

<span class="nc bnc" id="L149" title="All 2 branches missed.">        if (withoutSubScopeId) {</span>
<span class="nc" id="L150">            throw new FlowableIllegalArgumentException(&quot;Cannot combine subScopeId(String) with withoutSubScopeId() in the same query&quot;);</span>
        }

<span class="nc" id="L153">        this.subScopeId = subScopeId;</span>
<span class="nc" id="L154">        return this;</span>
    }

    @Override
    public InternalVariableInstanceQuery subScopeIds(Collection&lt;String&gt; subScopeIds) {
<span class="nc bnc" id="L159" title="All 2 branches missed.">        if (withoutSubScopeId) {</span>
<span class="nc" id="L160">            throw new FlowableIllegalArgumentException(&quot;Cannot combine subScopeIds with withoutSubScopeId in the same query&quot;);</span>
        }

<span class="nc" id="L163">        this.subScopeIds = subScopeIds;</span>
<span class="nc" id="L164">        return this;</span>
    }

    @Override
    public InternalVariableInstanceQuery withoutSubScopeId() {
<span class="nc bnc" id="L169" title="All 2 branches missed.">        if (subScopeId != null) {</span>
<span class="nc" id="L170">            throw new FlowableIllegalArgumentException(&quot;Cannot combine withoutSubScopeId() with subScopeId(String) in the same query&quot;);</span>
        }
<span class="nc" id="L172">        this.withoutSubScopeId = true;</span>
<span class="nc" id="L173">        return this;</span>
    }

    @Override
    public InternalVariableInstanceQuery scopeType(String scopeType) {
<span class="nc bnc" id="L178" title="All 2 branches missed.">        if (StringUtils.isEmpty(scopeType)) {</span>
<span class="nc" id="L179">            throw new FlowableIllegalArgumentException(&quot;scopeType is empty&quot;);</span>
        }
<span class="nc" id="L181">        this.scopeType = scopeType;</span>
<span class="nc" id="L182">        return this;</span>
    }

    @Override
    public InternalVariableInstanceQuery scopeTypes(Collection&lt;String&gt; scopeTypes) {
<span class="nc" id="L187">        this.scopeTypes = scopeTypes;</span>
<span class="nc" id="L188">        return this;</span>
    }

    @Override
    public InternalVariableInstanceQuery name(String name) {
<span class="nc bnc" id="L193" title="All 2 branches missed.">        if (StringUtils.isEmpty(name)) {</span>
<span class="nc" id="L194">            throw new FlowableIllegalArgumentException(&quot;name is empty&quot;);</span>
        }
<span class="nc" id="L196">        this.name = name;</span>
<span class="nc" id="L197">        return this;</span>
    }

    @Override
    public InternalVariableInstanceQuery names(Collection&lt;String&gt; names) {
<span class="nc" id="L202">        this.names = names;</span>
<span class="nc" id="L203">        return this;</span>
    }

    @Override
    public List&lt;VariableInstanceEntity&gt; list() {
<span class="nc" id="L208">        return dataManager.findVariablesInstancesByQuery(this);</span>
    }

    @Override
    public VariableInstanceEntity singleResult() {
<span class="nc" id="L213">        return dataManager.findVariablesInstanceByQuery(this);</span>
    }

    public String getId() {
<span class="nc" id="L217">        return id;</span>
    }

    public String getTaskId() {
<span class="nc" id="L221">        return taskId;</span>
    }

    public Collection&lt;String&gt; getTaskIds() {
<span class="nc" id="L225">        return taskIds;</span>
    }

    public String getProcessInstanceId() {
<span class="nc" id="L229">        return processInstanceId;</span>
    }

    public String getExecutionId() {
<span class="nc" id="L233">        return executionId;</span>
    }

    public Collection&lt;String&gt; getExecutionIds() {
<span class="nc" id="L237">        return executionIds;</span>
    }

    public boolean isWithoutTaskId() {
<span class="nc" id="L241">        return withoutTaskId;</span>
    }

    public String getScopeId() {
<span class="nc" id="L245">        return scopeId;</span>
    }

    public Collection&lt;String&gt; getScopeIds() {
<span class="nc" id="L249">        return scopeIds;</span>
    }

    public String getSubScopeId() {
<span class="nc" id="L253">        return subScopeId;</span>
    }

    public Collection&lt;String&gt; getSubScopeIds() {
<span class="nc" id="L257">        return subScopeIds;</span>
    }

    public boolean isWithoutSubScopeId() {
<span class="nc" id="L261">        return withoutSubScopeId;</span>
    }

    public String getScopeType() {
<span class="nc" id="L265">        return scopeType;</span>
    }

    public Collection&lt;String&gt; getScopeTypes() {
<span class="nc" id="L269">        return scopeTypes;</span>
    }

    public String getName() {
<span class="nc" id="L273">        return name;</span>
    }

    public Collection&lt;String&gt; getNames() {
<span class="nc" id="L277">        return names;</span>
    }

    // This method is needed because we have a different way of querying list and single objects via MyBatis.
    // Querying lists wraps the object in a ListQueryParameterObject
    public InternalVariableInstanceQueryImpl getParameter() {
<span class="nc" id="L283">        return this;</span>
    }

    @Override
    public boolean isRetained(Collection&lt;VariableInstanceEntity&gt; databaseEntities, Collection&lt;CachedEntity&gt; cachedEntities,
            VariableInstanceEntity entity, Object param) {
<span class="nc" id="L289">        return isRetained(entity, (InternalVariableInstanceQueryImpl) param);</span>
    }

    @Override
    public boolean isRetained(VariableInstanceEntity entity, Object param) {
<span class="nc" id="L294">        return isRetained(entity, (InternalVariableInstanceQueryImpl) param);</span>
    }

    public boolean isRetained(VariableInstanceEntity entity, InternalVariableInstanceQueryImpl param) {

<span class="nc bnc" id="L299" title="All 4 branches missed.">        if (param.executionId != null &amp;&amp; !param.executionId.equals(entity.getExecutionId())) {</span>
<span class="nc" id="L300">            return false;</span>
        }

<span class="nc bnc" id="L303" title="All 4 branches missed.">        if (param.scopeId != null &amp;&amp; !param.scopeId.equals(entity.getScopeId())) {</span>
<span class="nc" id="L304">            return false;</span>
        }

<span class="nc bnc" id="L307" title="All 4 branches missed.">        if (param.scopeIds != null &amp;&amp; !param.scopeIds.contains(entity.getScopeId())) {</span>
<span class="nc" id="L308">            return false;</span>
        }

<span class="nc bnc" id="L311" title="All 4 branches missed.">        if (param.taskId != null &amp;&amp; !param.taskId.equals(entity.getTaskId())) {</span>
<span class="nc" id="L312">            return false;</span>
        }

<span class="nc bnc" id="L315" title="All 4 branches missed.">        if (param.processInstanceId != null &amp;&amp; !param.processInstanceId.equals(entity.getProcessInstanceId())) {</span>
<span class="nc" id="L316">            return false;</span>
        }

<span class="nc bnc" id="L319" title="All 4 branches missed.">        if (param.withoutTaskId &amp;&amp; entity.getTaskId() != null) {</span>
<span class="nc" id="L320">            return false;</span>
        }

<span class="nc bnc" id="L323" title="All 4 branches missed.">        if (param.subScopeId != null &amp;&amp; !param.subScopeId.equals(entity.getSubScopeId())) {</span>
<span class="nc" id="L324">            return false;</span>
        }

<span class="nc bnc" id="L327" title="All 4 branches missed.">        if (param.subScopeIds != null &amp;&amp; !param.subScopeIds.contains(entity.getSubScopeId())) {</span>
<span class="nc" id="L328">            return false;</span>
        }

<span class="nc bnc" id="L331" title="All 4 branches missed.">        if (param.withoutSubScopeId &amp;&amp; entity.getSubScopeId() != null) {</span>
<span class="nc" id="L332">            return false;</span>
        }

<span class="nc bnc" id="L335" title="All 4 branches missed.">        if (param.scopeType != null &amp;&amp; !param.scopeType.equals(entity.getScopeType())) {</span>
<span class="nc" id="L336">            return false;</span>
        }

<span class="nc bnc" id="L339" title="All 6 branches missed.">        if (param.scopeTypes != null &amp;&amp; !param.scopeTypes.isEmpty() &amp;&amp; !param.scopeTypes.contains(entity.getScopeType())) {</span>
<span class="nc" id="L340">            return false;</span>
        }

<span class="nc bnc" id="L343" title="All 4 branches missed.">        if (param.id != null &amp;&amp; !param.id.equals(entity.getId())) {</span>
<span class="nc" id="L344">            return false;</span>
        }

<span class="nc bnc" id="L347" title="All 4 branches missed.">        if (param.taskIds != null &amp;&amp; !param.taskIds.contains(entity.getTaskId())) {</span>
<span class="nc" id="L348">            return false;</span>
        }

<span class="nc bnc" id="L351" title="All 4 branches missed.">        if (param.executionIds != null &amp;&amp; !param.executionIds.contains(entity.getExecutionId())) {</span>
<span class="nc" id="L352">            return false;</span>
        }

<span class="nc bnc" id="L355" title="All 4 branches missed.">        if (param.name != null &amp;&amp; !param.name.equals(entity.getName())) {</span>
<span class="nc" id="L356">            return false;</span>
        }

<span class="nc bnc" id="L359" title="All 6 branches missed.">        if (param.names != null &amp;&amp; !param.names.isEmpty() &amp;&amp; !param.names.contains(entity.getName())) {</span>
<span class="nc" id="L360">            return false;</span>
        }

<span class="nc" id="L363">        return true;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>